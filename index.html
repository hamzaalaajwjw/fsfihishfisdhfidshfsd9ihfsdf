<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ù‚Ø§Ù„Ø§Øª - Ù…Ù†ØµØ© Ø§Ù„Ù†Ø´Ø±</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            font-family: 'Cairo', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        body {
            overflow-x: hidden;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .article-card {
            transition: all 0.3s ease;
        }
        .article-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .mobile-menu {
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }
        .mobile-menu.open {
            transform: translateX(0);
        }
        .loading-spinner {
            width: 30px;
            height: 30px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ù„Ù„Ø¬ÙˆØ§Ù„ -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-3">
                <div class="flex items-center">
                    <h1 class="text-xl font-bold text-purple-700">Ù…Ù‚Ø§Ù„Ø§Øª</h1>
                </div>
                
                <div class="md:hidden">
                    <button id="mobileMenuBtn" class="text-gray-700 focus:outline-none">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                        </svg>
                    </button>
                </div>
                
                <div class="hidden md:flex items-center space-x-4 space-x-reverse">
                    <a href="index.html" class="text-gray-700 hover:text-purple-600 font-medium px-3 py-2">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                    <a href="#" id="createArticleBtn" class="text-gray-700 hover:text-purple-600 font-medium px-3 py-2">Ù…Ù‚Ø§Ù„ Ø¬Ø¯ÙŠØ¯</a>
                    <a href="#" id="profileBtn" class="text-gray-700 hover:text-purple-600 font-medium px-3 py-2">Ù…Ù„ÙÙŠ</a>
                    
                    <div id="authButtons" class="flex items-center space-x-2 space-x-reverse">
                        <a href="login.html" class="bg-purple-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-purple-700">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
                        <a href="register.html" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg text-sm hover:bg-gray-300">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</a>
                    </div>
                    
                    <div id="userMenu" class="hidden flex items-center space-x-3 space-x-reverse">
                        <img id="userAvatar" class="w-8 h-8 rounded-full object-cover border-2 border-white" src="https://ui-avatars.com/api/?name=User&background=667eea&color=fff" alt="">
                        <button id="logoutBtn" class="bg-red-500 text-white px-4 py-2 rounded-lg text-sm hover:bg-red-600">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬ÙˆØ§Ù„ -->
    <div id="mobileMenu" class="mobile-menu fixed inset-y-0 right-0 w-64 bg-white shadow-2xl z-50 md:hidden">
        <div class="p-6">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-xl font-bold text-purple-700">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h2>
                <button id="closeMobileMenu" class="text-gray-600">âœ•</button>
            </div>
            
            <div class="space-y-4">
                <a href="index.html" class="block text-gray-700 hover:text-purple-600 font-medium py-2 border-b">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                <a href="#" id="mobileCreateArticleBtn" class="block text-gray-700 hover:text-purple-600 font-medium py-2 border-b">Ù…Ù‚Ø§Ù„ Ø¬Ø¯ÙŠØ¯</a>
                <a href="#" id="mobileProfileBtn" class="block text-gray-700 hover:text-purple-600 font-medium py-2 border-b">Ù…Ù„ÙÙŠ Ø§Ù„Ø´Ø®ØµÙŠ</a>
                
                <div id="mobileAuthButtons" class="pt-4 space-y-3">
                    <a href="login.html" class="block bg-purple-600 text-white text-center py-3 rounded-lg hover:bg-purple-700">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
                    <a href="register.html" class="block bg-gray-200 text-gray-700 text-center py-3 rounded-lg hover:bg-gray-300">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</a>
                </div>
                
                <div id="mobileUserMenu" class="hidden pt-4 space-y-3">
                    <div class="flex items-center space-x-3 space-x-reverse mb-4">
                        <img id="mobileUserAvatar" class="w-10 h-10 rounded-full object-cover" src="https://ui-avatars.com/api/?name=User&background=667eea&color=fff" alt="">
                        <span id="mobileUserName" class="font-medium"></span>
                    </div>
                    <button id="mobileLogoutBtn" class="w-full bg-red-500 text-white py-3 rounded-lg hover:bg-red-600">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
                </div>
            </div>
        </div>
    </div>
    <div id="mobileMenuOverlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40 md:hidden"></div>

    <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø© -->
    <main class="container mx-auto px-4 py-6">
        <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« -->
        <div class="mb-8">
            <div class="max-w-2xl mx-auto">
                <input type="text" id="searchInput" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù‚Ø§Ù„ Ø£Ùˆ ÙƒØ§ØªØ¨..." 
                       class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 outline-none">
            </div>
        </div>

        <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª Ø§Ù„Ø£ÙƒØ«Ø± Ø±ÙˆØ§Ø¬Ø§Ù‹ -->
        <section class="mb-10">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-bold text-gray-800">ğŸ”¥ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª Ø§Ù„Ø£ÙƒØ«Ø± Ø±ÙˆØ§Ø¬Ø§Ù‹</h2>
                <span class="text-sm text-gray-500" id="trendingCount">0 Ù…Ù‚Ø§Ù„</span>
            </div>
            <div id="trendingArticles" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">
                <div class="text-center py-10 text-gray-500">
                    <div class="loading-spinner mx-auto mb-3"></div>
                    Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª...
                </div>
            </div>
        </section>

        <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª Ø§Ù„Ø­Ø¯ÙŠØ«Ø© -->
        <section class="mb-8">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-bold text-gray-800">ğŸ“ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª Ø§Ù„Ø­Ø¯ÙŠØ«Ø©</h2>
                <span class="text-sm text-gray-500" id="recentCount">0 Ù…Ù‚Ø§Ù„</span>
            </div>
            <div id="recentArticles">
                <div class="text-center py-10 text-gray-500">
                    <div class="loading-spinner mx-auto mb-3"></div>
                    Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª...
                </div>
            </div>
        </section>
    </main>

    <!-- Ø²Ø± Ø§Ù„Ù…Ù‚Ø§Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø¬ÙˆØ§Ù„ -->
    <div class="md:hidden fixed bottom-6 left-6 z-40">
        <button id="floatingCreateBtn" class="gradient-bg text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center hover:opacity-90">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
            </svg>
        </button>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù‚Ø§Ù„ -->
    <div id="createArticleModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-start md:items-center justify-center p-4 overflow-y-auto">
        <div class="bg-white rounded-lg w-full max-w-2xl my-4 md:my-0">
            <div class="sticky top-0 bg-white flex justify-between items-center p-4 border-b z-10">
                <h3 class="text-xl font-bold text-gray-800">âœï¸ Ù…Ù‚Ø§Ù„ Ø¬Ø¯ÙŠØ¯</h3>
                <button id="closeModalBtn" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            <form id="articleForm" class="p-4 md:p-6">
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2 font-medium">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‚Ø§Ù„ *</label>
                    <input type="text" id="articleTitle" required maxlength="100"
                           class="w-full px-4 py-3 text-base border border-gray-300 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 outline-none"
                           placeholder="Ø§ÙƒØªØ¨ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‚Ø§Ù„ Ù‡Ù†Ø§...">
                    <div class="text-xs text-gray-500 mt-1 text-left" id="titleCounter">0/100</div>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2 font-medium">Ø§Ù„Ù…Ø­ØªÙˆÙ‰ *</label>
                    <textarea id="articleContent" rows="8" required
                              class="w-full px-4 py-3 text-base border border-gray-300 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 outline-none resize-none"
                              placeholder="Ø§ÙƒØªØ¨ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù‚Ø§Ù„ Ù‡Ù†Ø§..."></textarea>
                </div>
                <div id="articleError" class="hidden bg-red-50 text-red-600 p-3 rounded-lg mb-4"></div>
                <div class="flex flex-col sm:flex-row justify-end space-y-3 sm:space-y-0 sm:space-x-3 space-x-reverse">
                    <button type="button" id="cancelArticleBtn" class="px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 w-full sm:w-auto">Ø¥Ù„ØºØ§Ø¡</button>
                    <button type="submit" id="submitArticleBtn" class="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 w-full sm:w-auto flex items-center justify-center">
                        <span>Ù†Ø´Ø± Ø§Ù„Ù…Ù‚Ø§Ù„</span>
                        <div id="articleSpinner" class="loading-spinner hidden ml-2"></div>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ -->
    <div id="alertContainer" class="fixed top-4 right-4 z-50 w-full max-w-sm space-y-3"></div>

    <script type="module">
        import { auth, db } from './js/firebase-config.js';
        import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
        import { collection, getDocs, addDoc, query, orderBy, limit, where, doc, getDoc, updateDoc, arrayUnion, arrayRemove, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

        class ArticleManager {
            constructor() {
                this.currentUser = null;
                this.articles = [];
                this.init();
            }

            async init() {
                await this.setupAuth();
                this.setupEventListeners();
                await this.loadArticles();
            }

            async setupAuth() {
                return new Promise((resolve) => {
                    onAuthStateChanged(auth, async (user) => {
                        this.currentUser = user;
                        this.updateAuthUI();
                        resolve();
                    });
                });
            }

            updateAuthUI() {
                const isLoggedIn = !!this.currentUser;
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                const authButtons = document.getElementById('authButtons');
                const userMenu = document.getElementById('userMenu');
                const userAvatar = document.getElementById('userAvatar');
                
                const mobileAuthButtons = document.getElementById('mobileAuthButtons');
                const mobileUserMenu = document.getElementById('mobileUserMenu');
                const mobileUserAvatar = document.getElementById('mobileUserAvatar');
                const mobileUserName = document.getElementById('mobileUserName');
                
                if (isLoggedIn) {
                    // Ø¥Ø®ÙØ§Ø¡ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
                    if (authButtons) authButtons.classList.add('hidden');
                    if (userMenu) userMenu.classList.remove('hidden');
                    if (userAvatar) {
                        userAvatar.src = this.currentUser.photoURL || 
                            `https://ui-avatars.com/api/?name=${encodeURIComponent(this.currentUser.displayName || 'User')}&background=667eea&color=fff`;
                    }
                    
                    // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¬ÙˆØ§Ù„
                    if (mobileAuthButtons) mobileAuthButtons.classList.add('hidden');
                    if (mobileUserMenu) mobileUserMenu.classList.remove('hidden');
                    if (mobileUserAvatar) {
                        mobileUserAvatar.src = this.currentUser.photoURL || 
                            `https://ui-avatars.com/api/?name=${encodeURIComponent(this.currentUser.displayName || 'User')}&background=667eea&color=fff`;
                    }
                    if (mobileUserName) {
                        mobileUserName.textContent = this.currentUser.displayName || 'Ù…Ø³ØªØ®Ø¯Ù…';
                    }
                } else {
                    // Ø¥Ø¸Ù‡Ø§Ø± Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆØ¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
                    if (authButtons) authButtons.classList.remove('hidden');
                    if (userMenu) userMenu.classList.add('hidden');
                    
                    if (mobileAuthButtons) mobileAuthButtons.classList.remove('hidden');
                    if (mobileUserMenu) mobileUserMenu.classList.add('hidden');
                }
            }

            async loadArticles() {
                try {
                    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª Ø§Ù„Ø£ÙƒØ«Ø± Ø¥Ø¹Ø¬Ø§Ø¨Ø§Ù‹
                    const trendingQuery = query(
                        collection(db, "articles"),
                        orderBy("likes", "desc"),
                        limit(6)
                    );
                    const trendingSnapshot = await getDocs(trendingQuery);
                    this.displayTrendingArticles(trendingSnapshot);
                    
                    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª Ø§Ù„Ø­Ø¯ÙŠØ«Ø©
                    const recentQuery = query(
                        collection(db, "articles"),
                        orderBy("createdAt", "desc"),
                        limit(10)
                    );
                    const recentSnapshot = await getDocs(recentQuery);
                    this.displayRecentArticles(recentSnapshot);
                    
                } catch (error) {
                    console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª:", error);
                    this.showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª', 'error');
                }
            }

            displayTrendingArticles(snapshot) {
                const container = document.getElementById('trendingArticles');
                const countElement = document.getElementById('trendingCount');
                
                if (snapshot.empty) {
                    container.innerHTML = `
                        <div class="col-span-3 text-center py-10 text-gray-500">
                            ğŸ“ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‚Ø§Ù„Ø§Øª Ø¨Ø¹Ø¯. ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠÙ†Ø´Ø± Ù…Ù‚Ø§Ù„Ø§Ù‹!
                        </div>
                    `;
                    countElement.textContent = '0 Ù…Ù‚Ø§Ù„';
                    return;
                }
                
                let html = '';
                snapshot.forEach((docSnapshot) => {
                    const article = docSnapshot.data();
                    const date = new Date(article.createdAt?.toDate?.() || article.createdAt);
                    
                    html += `
                        <div class="bg-white rounded-xl shadow-md overflow-hidden article-card">
                            <div class="p-4 md:p-5">
                                <h3 class="text-lg font-bold text-gray-800 mb-2 line-clamp-2">${article.title || 'Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†'}</h3>
                                <p class="text-gray-600 text-sm mb-3 line-clamp-2">${article.content?.substring(0, 80) || ''}...</p>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-2 space-x-reverse">
                                        <div class="w-8 h-8 rounded-full bg-gradient-to-r from-purple-400 to-purple-600 flex items-center justify-center text-white text-xs">
                                            ${article.authorName?.charAt(0) || 'Ù…'}
                                        </div>
                                        <span class="text-sm font-medium">${article.authorName || 'Ù…Ø³ØªØ®Ø¯Ù…'}</span>
                                    </div>
                                    <div class="flex items-center space-x-3 space-x-reverse">
                                        <button onclick="articleManager.likeArticle('${docSnapshot.id}')" class="flex items-center space-x-1 text-gray-500 hover:text-red-500">
                                            <span>â¤ï¸</span>
                                            <span class="text-xs">${article.likes || 0}</span>
                                        </button>
                                    </div>
                                </div>
                                <button onclick="window.location.href='profile.html?uid=${article.authorId}'" 
                                        class="mt-3 w-full text-center text-purple-600 hover:text-purple-700 text-sm py-2 border border-purple-200 rounded-lg hover:bg-purple-50">
                                    Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
                countElement.textContent = `${snapshot.size} Ù…Ù‚Ø§Ù„${snapshot.size > 1 ? 'Ø§Øª' : ''}`;
            }

            displayRecentArticles(snapshot) {
                const container = document.getElementById('recentArticles');
                const countElement = document.getElementById('recentCount');
                
                if (snapshot.empty) {
                    container.innerHTML = `
                        <div class="text-center py-10 text-gray-500">
                            ğŸ“ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‚Ø§Ù„Ø§Øª Ø¨Ø¹Ø¯. ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠÙ†Ø´Ø± Ù…Ù‚Ø§Ù„Ø§Ù‹!
                        </div>
                    `;
                    countElement.textContent = '0 Ù…Ù‚Ø§Ù„';
                    return;
                }
                
                let html = '';
                snapshot.forEach((docSnapshot) => {
                    const article = docSnapshot.data();
                    const date = new Date(article.createdAt?.toDate?.() || article.createdAt);
                    const timeAgo = this.getTimeAgo(date);
                    
                    html += `
                        <div class="bg-white rounded-xl shadow-md overflow-hidden mb-4 article-card">
                            <div class="p-4 md:p-5">
                                <div class="flex items-start justify-between mb-3">
                                    <div class="flex items-center space-x-3 space-x-reverse">
                                        <div class="w-10 h-10 rounded-full bg-gradient-to-r from-purple-400 to-purple-600 flex items-center justify-center text-white">
                                            ${article.authorName?.charAt(0) || 'Ù…'}
                                        </div>
                                        <div>
                                            <h4 class="font-bold text-gray-800">${article.authorName || 'Ù…Ø³ØªØ®Ø¯Ù…'}</h4>
                                            <p class="text-xs text-gray-500">${timeAgo}</p>
                                        </div>
                                    </div>
                                    ${this.currentUser && this.currentUser.uid !== article.authorId ? `
                                        <button onclick="articleManager.followUser('${article.authorId}')" 
                                                class="text-xs bg-purple-600 text-white px-3 py-1 rounded-full hover:bg-purple-700">
                                            Ù…ØªØ§Ø¨Ø¹Ø©
                                        </button>
                                    ` : ''}
                                </div>
                                
                                <h3 class="text-lg font-bold text-gray-800 mb-3">${article.title || 'Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†'}</h3>
                                <p class="text-gray-700 mb-4">${article.content || ''}</p>
                                
                                <div class="flex items-center justify-between border-t pt-3">
                                    <div class="flex space-x-4 space-x-reverse">
                                        <button onclick="articleManager.likeArticle('${docSnapshot.id}')" 
                                                class="flex items-center space-x-2 space-x-reverse text-gray-600 hover:text-red-500">
                                            <span>â¤ï¸</span>
                                            <span class="text-sm">${article.likes || 0}</span>
                                        </button>
                                        <button class="flex items-center space-x-2 space-x-reverse text-gray-600 hover:text-blue-500">
                                            <span>ğŸ’¬</span>
                                            <span class="text-sm">ØªØ¹Ù„ÙŠÙ‚</span>
                                        </button>
                                    </div>
                                    <button onclick="window.location.href='profile.html?uid=${article.authorId}'" 
                                            class="text-sm text-purple-600 hover:text-purple-700">
                                        Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù â†’
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
                countElement.textContent = `${snapshot.size} Ù…Ù‚Ø§Ù„${snapshot.size > 1 ? 'Ø§Øª' : ''}`;
            }

            getTimeAgo(date) {
                const now = new Date();
                const diff = now - date;
                
                const minute = 60 * 1000;
                const hour = minute * 60;
                const day = hour * 24;
                
                if (diff < minute) return 'Ø§Ù„Ø¢Ù†';
                if (diff < hour) return `Ù‚Ø¨Ù„ ${Math.floor(diff / minute)} Ø¯Ù‚ÙŠÙ‚Ø©`;
                if (diff < day) return `Ù‚Ø¨Ù„ ${Math.floor(diff / hour)} Ø³Ø§Ø¹Ø©`;
                if (diff < day * 7) return `Ù‚Ø¨Ù„ ${Math.floor(diff / day)} ÙŠÙˆÙ…`;
                
                return date.toLocaleDateString('ar-SA');
            }

            async likeArticle(articleId) {
                if (!this.currentUser) {
                    this.showAlert('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø¥Ø¹Ø¬Ø§Ø¨ Ø¨Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª', 'warning');
                    setTimeout(() => window.location.href = 'login.html', 1500);
                    return;
                }

                try {
                    const articleRef = doc(db, "articles", articleId);
                    const articleDoc = await getDoc(articleRef);
                    
                    if (articleDoc.exists()) {
                        const article = articleDoc.data();
                        await updateDoc(articleRef, {
                            likes: (article.likes || 0) + 1,
                            updatedAt: serverTimestamp()
                        });
                        
                        this.showAlert('ØªÙ… Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨ Ø¨Ø§Ù„Ù…Ù‚Ø§Ù„', 'success');
                        this.loadArticles();
                    }
                } catch (error) {
                    console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨:", error);
                    this.showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨', 'error');
                }
            }

            async followUser(userId) {
                if (!this.currentUser) {
                    this.showAlert('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†', 'warning');
                    setTimeout(() => window.location.href = 'login.html', 1500);
                    return;
                }

                if (this.currentUser.uid === userId) {
                    this.showAlert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ù…ØªØ§Ø¨Ø¹Ø© Ù†ÙØ³Ùƒ', 'warning');
                    return;
                }

                try {
                    const currentUserRef = doc(db, "users", this.currentUser.uid);
                    const targetUserRef = doc(db, "users", userId);
                    
                    // Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…ØªØ§Ø¨ÙØ¹ÙŠÙ†
                    await updateDoc(currentUserRef, {
                        following: arrayUnion(userId),
                        updatedAt: serverTimestamp()
                    });

                    // Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…ØªØ§Ø¨ÙØ¹ÙŠÙ†
                    await updateDoc(targetUserRef, {
                        followers: arrayUnion(this.currentUser.uid),
                        updatedAt: serverTimestamp()
                    });

                    this.showAlert('ØªÙ…Øª Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                } catch (error) {
                    console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©:", error);
                    this.showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©', 'error');
                }
            }

            async createArticle(title, content) {
                if (!this.currentUser) {
                    this.showAlert('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù†Ø´Ø± Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª', 'warning');
                    setTimeout(() => window.location.href = 'login.html', 1500);
                    return false;
                }

                try {
                    const articleData = {
                        title: title.trim(),
                        content: content.trim(),
                        authorId: this.currentUser.uid,
                        authorName: this.currentUser.displayName || 'Ù…Ø³ØªØ®Ø¯Ù…',
                        likes: 0,
                        comments: 0,
                        views: 0,
                        createdAt: serverTimestamp(),
                        updatedAt: serverTimestamp()
                    };

                    await addDoc(collection(db, "articles"), articleData);
                    return true;
                } catch (error) {
                    console.error("Ø®Ø·Ø£ ÙÙŠ Ù†Ø´Ø± Ø§Ù„Ù…Ù‚Ø§Ù„:", error);
                    return false;
                }
            }

            setupEventListeners() {
                // Ø²Ø± Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù‚Ø§Ù„ (Ø³Ø·Ø­ Ø§Ù„Ù…ÙƒØªØ¨)
                const createArticleBtn = document.getElementById('createArticleBtn');
                const mobileCreateArticleBtn = document.getElementById('mobileCreateArticleBtn');
                const floatingCreateBtn = document.getElementById('floatingCreateBtn');
                
                const showCreateModal = () => {
                    if (!this.currentUser) {
                        this.showAlert('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'warning');
                        setTimeout(() => window.location.href = 'login.html', 1500);
                        return;
                    }
                    document.getElementById('createArticleModal').classList.remove('hidden');
                    document.getElementById('articleTitle').focus();
                };
                
                if (createArticleBtn) createArticleBtn.addEventListener('click', showCreateModal);
                if (mobileCreateArticleBtn) mobileCreateArticleBtn.addEventListener('click', showCreateModal);
                if (floatingCreateBtn) floatingCreateBtn.addEventListener('click', showCreateModal);

                // Ø²Ø± Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
                const profileBtn = document.getElementById('profileBtn');
                const mobileProfileBtn = document.getElementById('mobileProfileBtn');
                
                const goToProfile = () => {
                    if (!this.currentUser) {
                        this.showAlert('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'warning');
                        setTimeout(() => window.location.href = 'login.html', 1500);
                        return;
                    }
                    window.location.href = 'profile.html';
                };
                
                if (profileBtn) profileBtn.addEventListener('click', goToProfile);
                if (mobileProfileBtn) mobileProfileBtn.addEventListener('click', goToProfile);

                // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
                const closeModalBtn = document.getElementById('closeModalBtn');
                const cancelArticleBtn = document.getElementById('cancelArticleBtn');
                const modal = document.getElementById('createArticleModal');
                
                const closeModal = () => {
                    modal.classList.add('hidden');
                    document.getElementById('articleForm').reset();
                    document.getElementById('articleError').classList.add('hidden');
                    document.getElementById('titleCounter').textContent = '0/100';
                };
                
                if (closeModalBtn) closeModalBtn.addEventListener('click', closeModal);
                if (cancelArticleBtn) cancelArticleBtn.addEventListener('click', closeModal);
                
                // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø¨Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) closeModal();
                });

                // Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                const logoutBtn = document.getElementById('logoutBtn');
                const mobileLogoutBtn = document.getElementById('mobileLogoutBtn');
                
                const handleLogout = async () => {
                    try {
                        await signOut(auth);
                        this.showAlert('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                        setTimeout(() => window.location.reload(), 1000);
                    } catch (error) {
                        console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬:", error);
                        this.showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬', 'error');
                    }
                };
                
                if (logoutBtn) logoutBtn.addEventListener('click', handleLogout);
                if (mobileLogoutBtn) mobileLogoutBtn.addEventListener('click', handleLogout);

                // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬ÙˆØ§Ù„
                const mobileMenuBtn = document.getElementById('mobileMenuBtn');
                const closeMobileMenu = document.getElementById('closeMobileMenu');
                const mobileMenu = document.getElementById('mobileMenu');
                const mobileMenuOverlay = document.getElementById('mobileMenuOverlay');
                
                if (mobileMenuBtn) {
                    mobileMenuBtn.addEventListener('click', () => {
                        mobileMenu.classList.add('open');
                        mobileMenuOverlay.classList.remove('hidden');
                    });
                }
                
                const hideMobileMenu = () => {
                    mobileMenu.classList.remove('open');
                    mobileMenuOverlay.classList.add('hidden');
                };
                
                if (closeMobileMenu) closeMobileMenu.addEventListener('click', hideMobileMenu);
                if (mobileMenuOverlay) mobileMenuOverlay.addEventListener('click', hideMobileMenu);

                // Ø¥Ø±Ø³Ø§Ù„ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ù‚Ø§Ù„
                const articleForm = document.getElementById('articleForm');
                const articleTitle = document.getElementById('articleTitle');
                const titleCounter = document.getElementById('titleCounter');
                
                // Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø­Ø±Ù Ù„Ù„Ø¹Ù†ÙˆØ§Ù†
                if (articleTitle) {
                    articleTitle.addEventListener('input', () => {
                        titleCounter.textContent = `${articleTitle.value.length}/100`;
                    });
                }
                
                if (articleForm) {
                    articleForm.addEventListener('submit', async (e) => {
                        e.preventDefault();
                        
                        const title = articleTitle.value.trim();
                        const content = document.getElementById('articleContent').value.trim();
                        const errorDiv = document.getElementById('articleError');
                        const submitBtn = document.getElementById('submitArticleBtn');
                        const spinner = document.getElementById('articleSpinner');
                        
                        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª
                        if (!title || title.length < 3) {
                            errorDiv.textContent = 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 3 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„';
                            errorDiv.classList.remove('hidden');
                            return;
                        }
                        
                        if (!content || content.length < 10) {
                            errorDiv.textContent = 'Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 10 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„';
                            errorDiv.classList.remove('hidden');
                            return;
                        }
                        
                        // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
                        submitBtn.disabled = true;
                        spinner.classList.remove('hidden');
                        
                        try {
                            const success = await this.createArticle(title, content);
                            
                            if (success) {
                                this.showAlert('ğŸ‰ ØªÙ… Ù†Ø´Ø± Ø§Ù„Ù…Ù‚Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                                closeModal();
                                await this.loadArticles(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
                            } else {
                                errorDiv.textContent = 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù†Ø´Ø± Ø§Ù„Ù…Ù‚Ø§Ù„';
                                errorDiv.classList.remove('hidden');
                            }
                        } catch (error) {
                            errorDiv.textContent = 'Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹';
                            errorDiv.classList.remove('hidden');
                        } finally {
                            submitBtn.disabled = false;
                            spinner.classList.add('hidden');
                        }
                    });
                }

                // Ø§Ù„Ø¨Ø­Ø«
                const searchInput = document.getElementById('searchInput');
                if (searchInput) {
                    let searchTimeout;
                    searchInput.addEventListener('input', (e) => {
                        clearTimeout(searchTimeout);
                        searchTimeout = setTimeout(() => {
                            this.searchArticles(e.target.value);
                        }, 500);
                    });
                }
            }

            async searchArticles(searchTerm) {
                const container = document.getElementById('recentArticles');
                if (!searchTerm.trim()) {
                    await this.loadArticles();
                    return;
                }

                try {
                    const articlesQuery = query(collection(db, "articles"));
                    const snapshot = await getDocs(articlesQuery);
                    
                    const results = [];
                    snapshot.forEach((doc) => {
                        const article = doc.data();
                        const searchLower = searchTerm.toLowerCase();
                        
                        if ((article.title && article.title.toLowerCase().includes(searchLower)) ||
                            (article.content && article.content.toLowerCase().includes(searchLower)) ||
                            (article.authorName && article.authorName.toLowerCase().includes(searchLower))) {
                            results.push({ id: doc.id, ...article });
                        }
                    });

                    if (results.length === 0) {
                        container.innerHTML = `
                            <div class="text-center py-10 text-gray-500">
                                ğŸ” Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù€ "${searchTerm}"
                            </div>
                        `;
                        return;
                    }

                    let html = `<h3 class="text-lg font-bold mb-4">Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« (${results.length})</h3>`;
                    results.forEach(article => {
                        html += `
                            <div class="bg-white rounded-lg shadow-md p-4 mb-3">
                                <h4 class="font-bold text-gray-800 mb-2">${article.title}</h4>
                                <p class="text-gray-600 text-sm mb-2">${article.content.substring(0, 100)}...</p>
                                <div class="flex justify-between items-center text-xs text-gray-500">
                                    <span>Ø¨ÙˆØ§Ø³Ø·Ø©: ${article.authorName}</span>
                                    <span>â¤ï¸ ${article.likes || 0}</span>
                                </div>
                            </div>
                        `;
                    });
                    
                    container.innerHTML = html;
                    
                } catch (error) {
                    console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø«:", error);
                }
            }

            showAlert(message, type = 'info') {
                const container = document.getElementById('alertContainer');
                const alertId = Date.now();
                
                const colors = {
                    success: 'bg-green-100 border-green-400 text-green-700',
                    error: 'bg-red-100 border-red-400 text-red-700',
                    warning: 'bg-yellow-100 border-yellow-400 text-yellow-700',
                    info: 'bg-blue-100 border-blue-400 text-blue-700'
                };
                
                const alertDiv = document.createElement('div');
                alertDiv.id = `alert-${alertId}`;
                alertDiv.className = `${colors[type]} border-l-4 p-4 rounded shadow-lg transform transition-all duration-300 translate-x-0`;
                alertDiv.innerHTML = `
                    <div class="flex items-center">
                        <span class="ml-3">${message}</span>
                        <button onclick="document.getElementById('alert-${alertId}').remove()" 
                                class="mr-auto text-xl font-bold hover:opacity-70">Ã—</button>
                    </div>
                `;
                
                container.appendChild(alertDiv);
                
                // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†Ù
                setTimeout(() => {
                    const alertElement = document.getElementById(`alert-${alertId}`);
                    if (alertElement) {
                        alertElement.style.transform = 'translateX(100%)';
                        setTimeout(() => alertElement.remove(), 300);
                    }
                }, 5000);
            }
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø¯ÙŠØ±
        window.articleManager = new ArticleManager();
    </script>
</body>
</html>
