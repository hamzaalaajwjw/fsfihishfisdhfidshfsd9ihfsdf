<!DOCTYPE html><html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Red Pill Platform</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body{margin:0;font-family:'Cairo',sans-serif;background:#0f0f0f;color:#eee}
    header{padding:15px 20px;background:#151515;font-size:20px;font-weight:700}
    .container{display:flex;min-height:100vh}
    aside{width:260px;background:#111;padding:15px;box-sizing:border-box}
    main{flex:1;padding:20px}
    .btn{width:100%;padding:10px;margin:6px 0;border:none;border-radius:8px;background:#c62828;color:#fff;font-size:15px;cursor:pointer}
    .btn.secondary{background:#333}
    .card{background:#1a1a1a;border-radius:12px;padding:15px;margin-bottom:15px}
    .article-title{font-size:18px;font-weight:700}
    .likes{color:#ff5252;cursor:pointer}
    textarea,input{width:100%;background:#0f0f0f;border:1px solid #333;color:#fff;border-radius:8px;padding:8px;margin-top:6px}
    .comment{font-size:14px;border-bottom:1px solid #333;padding:6px 0}
    @media(max-width:900px){
      .container{flex-direction:column}
      aside{width:100%}
    }
  </style>
</head>
<body>
<header>منصة Red Pill</header>
<div class="container">
  <aside>
    <div id="authBox" class="card"></div>
    <button class="btn" onclick="showPublish()">نشر مقال</button>
  </aside>
  <main>
    <h2>الأكثر إثارة</h2>
    <div id="articles"></div>
  </main>
</div><script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getDatabase, ref, push, onValue, update } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCdoubvkI7VEvYxtG3CzKFAJg74XXl7fX4",
  authDomain: "redpill-1c7e2.firebaseapp.com",
  databaseURL: "https://redpill-1c7e2-default-rtdb.firebaseio.com",
  projectId: "redpill-1c7e2",
  storageBucket: "redpill-1c7e2.firebasestorage.app",
  messagingSenderId: "337690521778",
  appId: "1:337690521778:web:ba3c99ad55e6b0d58f59ab"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

const authBox = document.getElementById('authBox');
const articlesDiv = document.getElementById('articles');

onAuthStateChanged(auth,user=>{
  if(user){
    authBox.innerHTML = `<p>مرحباً ${user.email}</p><button class='btn secondary' id='logout'>تسجيل خروج</button>`;
    document.getElementById('logout').onclick=()=>signOut(auth);
  } else {
    authBox.innerHTML = `
      <input id='email' placeholder='ايميل'>
      <input id='pass' type='password' placeholder='كلمة المرور'>
      <button class='btn' id='login'>دخول</button>
      <button class='btn secondary' id='register'>انشاء حساب</button>`;
    document.getElementById('login').onclick=()=>login();
    document.getElementById('register').onclick=()=>register();
  }
});

function login(){
  signInWithEmailAndPassword(auth,email.value,pass.value).catch(e=>alert(e.message));
}
function register(){
  createUserWithEmailAndPassword(auth,email.value,pass.value).catch(e=>alert(e.message));
}

window.showPublish = ()=>{
  if(!auth.currentUser){alert('سجل دخول اولاً');return;}
  const title = prompt('عنوان المقال');
  const content = prompt('نص المقال');
  if(!title||!content)return;
  push(ref(db,'articles'),{
    title,content,likes:0,created:Date.now(),author:auth.currentUser.uid
  });
}

onValue(ref(db,'articles'),snap=>{
  articlesDiv.innerHTML='';
  let arr=[];
  snap.forEach(s=>arr.push({id:s.key,...s.val()}));
  arr.sort((a,b)=>b.likes-a.likes);
  arr.forEach(a=>{
    const d=document.createElement('div');
    d.className='card';
    d.innerHTML=`
      <div class='article-title'>${a.title}</div>
      <p>${a.content}</p>
      <div class='likes'>❤️ ${a.likes}</div>`;
    d.querySelector('.likes').onclick=()=>{
      if(!auth.currentUser){alert('سجل دخول');return;}
      update(ref(db,'articles/'+a.id),{likes:(a.likes||0)+1});
    }
    articlesDiv.appendChild(d);
  })
});
</script></body>
</html>