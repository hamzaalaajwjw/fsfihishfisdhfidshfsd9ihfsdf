<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Red Pill</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;800&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:'Cairo',sans-serif;
  background:#0b0b0d;
  color:#fff;
}

/* ===== Layout ===== */
.layout{display:flex;min-height:100vh}
aside{
  width:240px;
  background:#141417;
  padding:14px;
}
main{flex:1;padding:16px;max-width:900px;margin:auto}

/* ===== Sidebar ===== */
aside button{
  width:100%;
  background:none;
  border:none;
  color:#fff;
  padding:12px;
  text-align:right;
  font-size:15px;
}
aside button.active{background:#1f1f26}

/* ===== Mobile ===== */
.menu-btn{
  display:none;
  position:fixed;
  top:10px;right:10px;
  z-index:999;
  background:#e53935;
  border:none;
  color:#fff;
  padding:10px 14px;
  border-radius:8px;
}
@media(max-width:768px){
  aside{
    position:fixed;
    right:-260px;
    top:0;
    height:100%;
    transition:.25s;
    z-index:998;
  }
  aside.open{right:0}
  .menu-btn{display:block}
}

/* ===== Pages ===== */
.page{display:none}
.page.active{display:block}

/* ===== Cards ===== */
.card{
  background:#1b1b20;
  border:1px solid #26262c;
  border-radius:14px;
  padding:14px;
  margin-bottom:14px;
}
input,textarea{
  width:100%;
  background:#0f0f13;
  border:1px solid #26262c;
  border-radius:10px;
  padding:10px;
  color:#fff;
  margin-top:6px;
}
.btn{
  width:100%;
  background:#e53935;
  border:none;
  padding:10px;
  border-radius:10px;
  color:#fff;
  font-weight:700;
  margin-top:10px;
}
.like{cursor:pointer;color:#ff5a5a}
</style>
</head>

<body>

<button class="menu-btn" onclick="toggleMenu()">â˜°</button>

<div class="layout">

<aside id="sidebar">
  <button onclick="showPage('feed')" class="active">ğŸ  Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª</button>
  <button onclick="showPage('login')">ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</button>
  <button onclick="showPage('register')">â• Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
  <button onclick="showPage('publish')">âœï¸ Ù†Ø´Ø± Ù…Ù‚Ø§Ù„</button>
  <button onclick="showPage('profile')">ğŸ‘¤ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</button>
</aside>

<main>

<!-- ===== Feed ===== -->
<section id="feed" class="page active">
  <h2>ğŸ”¥ Ø£Ø­Ø¯Ø« Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª</h2>
  <div id="articles"></div>
</section>

<!-- ===== Login ===== -->
<section id="login" class="page">
  <div class="card">
    <h3>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</h3>
    <input id="loginEmail" placeholder="Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„">
    <input id="loginPass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
    <button class="btn" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
  </div>
</section>

<!-- ===== Register ===== -->
<section id="register" class="page">
  <div class="card">
    <h3>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</h3>
    <input id="regEmail" placeholder="Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„">
    <input id="regPass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
    <button class="btn" onclick="register()">ØªØ³Ø¬ÙŠÙ„</button>
  </div>
</section>

<!-- ===== Publish ===== -->
<section id="publish" class="page">
  <div class="card">
    <h3>âœï¸ Ù†Ø´Ø± Ù…Ù‚Ø§Ù„</h3>
    <input id="postTitle" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†">
    <textarea id="postContent" rows="5" placeholder="Ù†Øµ Ø§Ù„Ù…Ù‚Ø§Ù„"></textarea>
    <button class="btn" onclick="publish()">Ù†Ø´Ø±</button>
  </div>
</section>

<!-- ===== Profile ===== -->
<section id="profile" class="page">
  <div class="card" id="profileBox"></div>
</section>

</main>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getDatabase, ref, push, onValue, update, get, set } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCdoubvkI7VEvYxtG3CzKFAJg74XXl7fX4",
  authDomain: "redpill-1c7e2.firebaseapp.com",
  databaseURL: "https://redpill-1c7e2-default-rtdb.firebaseio.com",
  projectId: "redpill-1c7e2",
  appId: "1:337690521778:web:ba3c99ad55e6b0d58f59ab"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

/* ===== SPA ===== */
window.showPage=(id)=>{
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('aside button').forEach(b=>b.classList.remove('active'));
  event.target.classList.add('active');
  sidebar.classList.remove('open');
}
window.toggleMenu=()=>sidebar.classList.toggle('open');

/* ===== Auth ===== */
window.login=()=>signInWithEmailAndPassword(auth,loginEmail.value,loginPass.value);
window.register=()=>createUserWithEmailAndPassword(auth,regEmail.value,regPass.value);

/* ===== Profile ===== */
onAuthStateChanged(auth,async user=>{
  if(!user) return;
  const r=ref(db,'users/'+user.uid);
  const s=await get(r);
  if(!s.exists()) set(r,{username:'Ù…Ø³ØªØ®Ø¯Ù…',bio:''});
  profileBox.innerHTML=`<h3>${user.email}</h3>`;
});

/* ===== Publish ===== */
window.publish=()=>{
  if(!auth.currentUser) return alert('Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„');
  push(ref(db,'articles'),{
    title:postTitle.value,
    content:postContent.value,
    created:Date.now(),
    likes:0
  });
  postTitle.value=postContent.value='';
  showPage('feed');
}

/* ===== Feed ===== */
onValue(ref(db,'articles'),snap=>{
  articles.innerHTML='';
  let arr=[];
  snap.forEach(s=>arr.push({id:s.key,...s.val()}));
  arr.sort((a,b)=>b.created-a.created);
  arr.forEach(a=>{
    articles.innerHTML+=`
      <div class="card">
        <h3>${a.title}</h3>
        <p>${a.content}</p>
      </div>`;
  });
});
</script>

</body>
</html>