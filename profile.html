<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ - Ù…Ù‚Ø§Ù„Ø§Øª</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module" src="./js/firebase-config.js"></script>
    <script type="module" src="./js/auth.js" defer></script>
    <style>
        * { font-family: 'Cairo', sans-serif; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ -->
    <nav class="bg-white shadow-lg">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center">
                    <a href="index.html" class="text-2xl font-bold text-purple-700">Ù…Ù‚Ø§Ù„Ø§Øª</a>
                </div>
                <div class="flex items-center space-x-4 space-x-reverse">
                    <a href="index.html" class="text-gray-700 hover:text-purple-600">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                    <button id="logoutBtn" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
                </div>
            </div>
        </div>
    </nav>

    <main class="container mx-auto px-4 py-8">
        <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <div class="flex flex-col md:flex-row items-center md:items-start space-y-6 md:space-y-0 md:space-x-6 space-x-reverse">
                <img id="profileAvatar" src="https://ui-avatars.com/api/?name=User&background=667eea&color=fff" 
                     class="w-32 h-32 rounded-full object-cover border-4 border-white shadow-lg">
                
                <div class="flex-1 text-center md:text-right">
                    <h1 id="profileName" class="text-3xl font-bold text-gray-800"></h1>
                    <p id="profileBio" class="text-gray-600 mt-2">Ù„Ù… ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© ÙˆØµÙ Ø¨Ø¹Ø¯</p>
                    <div class="flex justify-center md:justify-start space-x-6 space-x-reverse mt-4">
                        <div class="text-center">
                            <span id="followersCount" class="block text-2xl font-bold text-gray-800">0</span>
                            <span class="text-gray-600">Ù…ØªØ§Ø¨ÙØ¹</span>
                        </div>
                        <div class="text-center">
                            <span id="followingCount" class="block text-2xl font-bold text-gray-800">0</span>
                            <span class="text-gray-600">Ù…ØªØ§Ø¨ÙØ¹</span>
                        </div>
                        <div class="text-center">
                            <span id="articlesCount" class="block text-2xl font-bold text-gray-800">0</span>
                            <span class="text-gray-600">Ù…Ù‚Ø§Ù„Ø§Øª</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ù…Ù‚Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
        <section>
            <h2 class="text-2xl font-bold text-gray-800 mb-6">Ù…Ù‚Ø§Ù„Ø§ØªÙŠ</h2>
            <div id="userArticles" class="space-y-6">
                <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
            </div>
        </section>
    </main>

    <script type="module">
        import { auth, db } from './js/firebase-config.js';
        import { doc, getDoc, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";
        import { signOut } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";

        document.addEventListener('DOMContentLoaded', async () => {
            const user = auth.currentUser;
            
            if (!user) {
                window.location.href = 'login.html';
                return;
            }

            // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
            const profileName = document.getElementById('profileName');
            const profileAvatar = document.getElementById('profileAvatar');
            const followersCount = document.getElementById('followersCount');
            const followingCount = document.getElementById('followingCount');
            const articlesCount = document.getElementById('articlesCount');

            profileName.textContent = user.displayName || 'Ù…Ø³ØªØ®Ø¯Ù…';
            profileAvatar.src = user.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.displayName || 'User')}&background=667eea&color=fff`;

            // Ø¬Ù„Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Firestore
            const userDoc = await getDoc(doc(db, "users", user.uid));
            if (userDoc.exists()) {
                const userData = userDoc.data();
                followersCount.textContent = userData.followers?.length || 0;
                followingCount.textContent = userData.following?.length || 0;
                
                // Ø¬Ù„Ø¨ Ù…Ù‚Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                const articlesQuery = query(collection(db, "articles"), where("authorId", "==", user.uid));
                const articlesSnapshot = await getDocs(articlesQuery);
                articlesCount.textContent = articlesSnapshot.size;
                
                // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª
                const userArticles = document.getElementById('userArticles');
                articlesSnapshot.forEach((doc) => {
                    const article = doc.data();
                    userArticles.innerHTML += `
                        <div class="bg-white rounded-lg shadow-md p-6 article-card">
                            <h3 class="text-xl font-bold text-gray-800 mb-2">${article.title}</h3>
                            <p class="text-gray-600 mb-4">${article.content.substring(0, 200)}...</p>
                            <div class="flex justify-between items-center text-sm text-gray-500">
                                <div class="flex space-x-4 space-x-reverse">
                                    <span>â¤ï¸ ${article.likes || 0}</span>
                                    <span>ğŸ’¬ ${article.comments || 0}</span>
                                    <span>ğŸ‘ï¸ ${article.views || 0}</span>
                                </div>
                                <span>${new Date(article.createdAt).toLocaleDateString('ar-SA')}</span>
                            </div>
                        </div>
                    `;
                });
            }

            // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
            document.getElementById('logoutBtn').addEventListener('click', async () => {
                await signOut(auth);
                window.location.href = 'index.html';
            });
        });
    </script>
</body>
</html>
