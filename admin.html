<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø´Ø±Ù - Ù…Ù†ØªØ¯Ù‰ Ø§Ù„Ø±ÙŠØ¯Ø¨ÙŠÙ„</title>
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
  /* =====================================================
     GLOBAL / RESET
  ===================================================== */
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }
  
  body {
    font-family: 'Cairo', sans-serif;
    background: #000000;
    color: #ffffff;
    overflow-x: hidden;
    line-height: 1.6;
    min-height: 100vh;
  }
  
  h1, h2, h3, h4, h5, h6 {
    margin: 0;
    font-weight: 700;
    line-height: 1.3;
  }
  
  button {
    cursor: pointer;
    font-family: inherit;
    border: none;
    outline: none;
    background: none;
  }
  
  a {
    text-decoration: none;
    color: inherit;
  }
  
  /* =====================================================
     THEME VARIABLES
  ===================================================== */
  :root {
    --bg: #000000;
    --panel: #0a0a0a;
    --card: #111111;
    --card-hover: #1a1a1a;
    --border: rgba(255, 255, 255, 0.1);
    --accent: #ffffff;
    --text: #ffffff;
    --text-muted: #aaaaaa;
    --text-light: #f5f5f5;
    --red: #ff4757;
    --green: #2ed573;
    --blue: #1e90ff;
    --yellow: #ffa502;
    --radius: 12px;
    --radius-sm: 8px;
  }
  
  /* =====================================================
     ADMIN LAYOUT
  ===================================================== */
  .admin-header {
    height: 70px;
    background: rgba(20, 20, 20, 0.95);
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 20px;
    position: sticky;
    top: 0;
    z-index: 100;
  }
  
  .admin-logo {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 18px;
    font-weight: 700;
    color: var(--text);
  }
  
  .admin-logo i {
    font-size: 18px;
    color: var(--blue);
  }
  
  .admin-nav {
    display: flex;
    gap: 15px;
  }
  
  .admin-main {
    display: flex;
    min-height: calc(100vh - 70px);
  }
  
  .admin-sidebar {
    width: 250px;
    background: var(--panel);
    border-right: 1px solid var(--border);
    padding: 20px 16px;
    display: flex;
    flex-direction: column;
    gap: 16px;
    overflow-y: auto;
    max-height: calc(100vh - 70px);
  }
  
  .admin-content {
    flex: 1;
    padding: 20px;
    max-width: 100%;
    width: 100%;
    overflow-x: hidden;
  }
  
  /* =====================================================
     ADMIN UI COMPONENTS
  ===================================================== */
  .admin-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 20px;
    margin-bottom: 20px;
  }
  
  .admin-stat-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 20px;
    text-align: center;
  }
  
  .admin-stat-value {
    font-size: 32px;
    font-weight: 700;
    color: var(--text);
    line-height: 1;
  }
  
  .admin-stat-label {
    font-size: 13px;
    color: var(--text-muted);
    margin-top: 8px;
    font-weight: 500;
  }
  
  .admin-section-title {
    font-size: 20px;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 1px solid var(--border);
  }
  
  .admin-btn {
    padding: 10px 20px;
    border-radius: var(--radius-sm);
    border: none;
    background: #222222;
    color: var(--text);
    font-weight: 600;
    font-size: 14px;
    transition: all 0.2s;
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }
  
  .admin-btn:hover {
    background: #333333;
  }
  
  .admin-btn.primary {
    background: var(--blue);
    color: white;
  }
  
  .admin-btn.primary:hover {
    background: #1c7ed6;
  }
  
  .admin-btn.danger {
    background: var(--red);
    color: white;
  }
  
  .admin-btn.danger:hover {
    background: #ff3838;
  }
  
  .admin-btn.success {
    background: var(--green);
    color: white;
  }
  
  .admin-btn.success:hover {
    background: #25c063;
  }
  
  .admin-btn.warning {
    background: var(--yellow);
    color: white;
  }
  
  .admin-btn.warning:hover {
    background: #e69500;
  }
  
  .admin-btn.small {
    padding: 8px 16px;
    font-size: 13px;
  }
  
  .admin-btn.xsmall {
    padding: 6px 12px;
    font-size: 12px;
  }
  
  .admin-menu-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    background: transparent;
    color: var(--text-light);
    border-radius: var(--radius-sm);
    transition: all 0.2s;
    border: none;
    width: 100%;
    text-align: right;
    font-size: 14px;
    font-weight: 600;
  }
  
  .admin-menu-item:hover {
    background: rgba(255, 255, 255, 0.05);
    color: var(--accent);
  }
  
  .admin-menu-item.active {
    background: rgba(30, 144, 255, 0.2);
    color: var(--blue);
    border-right: 3px solid var(--blue);
  }
  
  .admin-menu-item i {
    width: 20px;
    font-size: 16px;
    color: inherit;
  }
  
  /* =====================================================
     ADMIN TABLES
  ===================================================== */
  .admin-table-container {
    overflow-x: auto;
    border-radius: var(--radius-sm);
    border: 1px solid var(--border);
  }
  
  .admin-table {
    width: 100%;
    border-collapse: collapse;
    min-width: 800px;
  }
  
  .admin-table th {
    background: #222222;
    color: var(--text);
    font-weight: 600;
    font-size: 14px;
    padding: 12px 16px;
    text-align: right;
    border-bottom: 1px solid var(--border);
  }
  
  .admin-table td {
    padding: 12px 16px;
    font-size: 14px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    color: var(--text-light);
  }
  
  .admin-table tr:hover td {
    background: rgba(255, 255, 255, 0.02);
  }
  
  .admin-table .actions {
    display: flex;
    gap: 8px;
    justify-content: flex-end;
  }
  
  .user-badge {
    display: inline-block;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 600;
    background: rgba(30, 144, 255, 0.2);
    color: var(--blue);
  }
  
  .user-badge.admin {
    background: rgba(255, 71, 87, 0.2);
    color: var(--red);
  }
  
  /* =====================================================
     ADMIN MODALS
  ===================================================== */
  .admin-modal-overlay {
    position: fixed;
    top: 0;
    right: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    padding: 20px;
  }
  
  .admin-modal {
    background: var(--panel);
    border-radius: var(--radius);
    padding: 24px;
    width: 90%;
    max-width: 700px;
    border: 1px solid var(--border);
    position: relative;
    max-height: 90vh;
    overflow-y: auto;
  }
  
  .admin-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }
  
  .admin-modal-header h3 {
    font-size: 20px;
    color: var(--text);
  }
  
  .admin-modal-close {
    background: rgba(255, 255, 255, 0.05);
    color: var(--text-muted);
    font-size: 18px;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    border: 1px solid var(--border);
    transition: all 0.2s;
  }
  
  .admin-modal-close:hover {
    background: rgba(255, 255, 255, 0.1);
    color: var(--text);
    border-color: var(--accent);
  }
  
  /* =====================================================
     ADMIN FORM ELEMENTS
  ===================================================== */
  .admin-form-group {
    margin-bottom: 20px;
  }
  
  .admin-form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: var(--text);
    font-size: 14px;
  }
  
  .admin-form-control {
    width: 100%;
    background: #222222;
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 12px 16px;
    color: var(--text);
    font-family: 'Cairo', sans-serif;
    font-size: 14px;
  }
  
  .admin-form-control:focus {
    outline: none;
    border-color: var(--blue);
  }
  
  /* =====================================================
     LOADING & EMPTY STATES
  ===================================================== */
  .admin-loading {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 60px;
  }
  
  .admin-spinner {
    width: 40px;
    height: 40px;
    border: 3px solid rgba(255, 255, 255, 0.1);
    border-radius: 50%;
    border-top-color: var(--blue);
    animation: admin-spin 1s linear infinite;
  }
  
  @keyframes admin-spin {
    to { transform: rotate(360deg); }
  }
  
  .admin-empty-state {
    text-align: center;
    padding: 60px 20px;
    color: var(--text-muted);
  }
  
  .admin-empty-state i {
    font-size: 48px;
    margin-bottom: 16px;
    opacity: 0.5;
    color: var(--text);
  }
  
  .admin-empty-state h3 {
    font-size: 18px;
    margin-bottom: 12px;
    color: var(--text);
  }
  
  /* =====================================================
     STATS GRID
  ===================================================== */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }
  
  /* =====================================================
     USER DETAILS
  ===================================================== */
  .user-details {
    background: #222222;
    border-radius: var(--radius-sm);
    padding: 20px;
    margin-bottom: 20px;
    border: 1px solid var(--border);
  }
  
  .user-header {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 20px;
  }
  
  .user-avatar {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: #333333;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    font-weight: 700;
    color: white;
    border: 2px solid var(--border);
  }
  
  .user-info h3 {
    font-size: 18px;
    margin-bottom: 4px;
    color: var(--text);
  }
  
  .user-info .email {
    color: var(--text-muted);
    font-size: 14px;
  }
  
  /* =====================================================
     RESPONSIVE DESIGN
  ===================================================== */
  @media (max-width: 1200px) {
    .stats-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }
  
  @media (max-width: 992px) {
    .admin-sidebar {
      position: fixed;
      top: 70px;
      left: -250px;
      height: calc(100vh - 70px);
      z-index: 100;
      width: 250px;
      transition: left 0.3s;
    }
    
    .admin-sidebar.active {
      left: 0;
    }
    
    .admin-menu-toggle {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .admin-overlay {
      display: none;
      position: fixed;
      top: 70px;
      right: 0;
      width: 100%;
      height: calc(100vh - 70px);
      background: rgba(0, 0, 0, 0.8);
      z-index: 90;
    }
    
    .admin-overlay.active {
      display: block;
    }
    
    .admin-content {
      padding: 16px;
    }
  }
  
  @media (max-width: 768px) {
    .admin-header {
      padding: 0 16px;
      height: 60px;
    }
    
    .admin-logo {
      font-size: 16px;
    }
    
    .admin-logo i {
      font-size: 16px;
    }
    
    .admin-nav {
      gap: 10px;
    }
    
    .admin-btn {
      padding: 8px 16px;
      font-size: 13px;
    }
    
    .admin-section-title {
      font-size: 18px;
    }
    
    .admin-card {
      padding: 16px;
    }
    
    .admin-modal {
      padding: 16px;
      width: 95%;
    }
    
    .stats-grid {
      grid-template-columns: 1fr;
      gap: 16px;
    }
    
    .admin-stat-value {
      font-size: 28px;
    }
    
    .admin-table th,
    .admin-table td {
      padding: 10px 12px;
      font-size: 13px;
    }
  }
  
  @media (max-width: 576px) {
    .admin-header {
      padding: 0 12px;
    }
    
    .admin-logo span {
      font-size: 14px;
    }
    
    .admin-nav {
      gap: 8px;
    }
    
    .admin-btn {
      padding: 6px 12px;
      font-size: 12px;
    }
    
    .admin-btn span {
      display: none;
    }
    
    .admin-section-title {
      font-size: 16px;
    }
    
    .admin-card {
      padding: 14px;
    }
    
    .admin-stat-card {
      padding: 16px;
    }
    
    .admin-stat-value {
      font-size: 24px;
    }
    
    .admin-table .actions {
      flex-direction: column;
      gap: 6px;
    }
  }
  
  /* =====================================================
     PAGINATION
  ===================================================== */
  .admin-pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid var(--border);
  }
  
  .pagination-btn {
    padding: 8px 16px;
    background: #222222;
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    color: var(--text);
    font-weight: 600;
    font-size: 14px;
    transition: all 0.2s;
    min-width: 40px;
    text-align: center;
  }
  
  .pagination-btn:hover:not(:disabled) {
    background: #333333;
    border-color: var(--blue);
  }
  
  .pagination-btn.active {
    background: var(--blue);
    border-color: var(--blue);
    color: white;
  }
  
  .pagination-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
  
  /* =====================================================
     FILTERS
  ===================================================== */
  .admin-filters {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }
  
  .filter-input {
    flex: 1;
    min-width: 200px;
  }
  
  .filter-select {
    width: 150px;
  }
  </style>
</head>
<body>
  <!-- ================= ADMIN HEADER ================= -->
  <header class="admin-header">
    <div class="admin-logo">
      <i class="fas fa-shield-alt"></i>
      <span>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø´Ø±Ù</span>
    </div>
    
    <div class="admin-nav">
      <button class="admin-btn" onclick="location.href='index.html'">
        <i class="fas fa-home"></i>
        <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
      </button>
      <button class="admin-btn danger" id="adminLogoutBtn">
        <i class="fas fa-sign-out-alt"></i>
        <span>ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</span>
      </button>
    </div>
  </header>
  
  <!-- ================= ADMIN MAIN ================= -->
  <div class="admin-main">
    <!-- ================= SIDEBAR ================= -->
    <div class="admin-sidebar" id="adminSidebar">
      <div class="admin-menu-item active" onclick="showAdminSection('dashboard')">
        <i class="fas fa-tachometer-alt"></i>
        <span>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span>
      </div>
      
      <div class="admin-menu-item" onclick="showAdminSection('articles')">
        <i class="fas fa-newspaper"></i>
        <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª</span>
      </div>
      
      <div class="admin-menu-item" onclick="showAdminSection('users')">
        <i class="fas fa-users"></i>
        <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</span>
      </div>
      
      <div class="admin-menu-item" onclick="showAdminSection('reports')">
        <i class="fas fa-chart-bar"></i>
        <span>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</span>
      </div>
      
      <div class="admin-menu-item" onclick="showAdminSection('settings')">
        <i class="fas fa-cog"></i>
        <span>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
      </div>
    </div>
    
    <div class="admin-overlay" id="adminOverlay" onclick="toggleAdminSidebar()"></div>
    
    <!-- ================= MAIN CONTENT ================= -->
    <main class="admin-content">
      <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
      <div id="dashboardSection" class="admin-section">
        <h2 class="admin-section-title"><i class="fas fa-tachometer-alt"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
        
        <div class="stats-grid" id="statsGrid">
          <div class="admin-stat-card">
            <div class="admin-stat-value" id="totalUsers">0</div>
            <div class="admin-stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
          </div>
          
          <div class="admin-stat-card">
            <div class="admin-stat-value" id="totalArticles">0</div>
            <div class="admin-stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª</div>
          </div>
          
          <div class="admin-stat-card">
            <div class="admin-stat-value" id="totalComments">0</div>
            <div class="admin-stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</div>
          </div>
          
          <div class="admin-stat-card">
            <div class="admin-stat-value" id="totalLikes">0</div>
            <div class="admin-stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨Ø§Øª</div>
          </div>
        </div>
        
        <div class="admin-card">
          <h3><i class="fas fa-chart-line"></i> Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„ÙŠÙˆÙ…ÙŠ</h3>
          <div id="dailyActivity">
            <div class="admin-loading">
              <div class="admin-spinner"></div>
            </div>
          </div>
        </div>
        
        <div class="admin-card">
          <h3><i class="fas fa-fire"></i> Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª Ø§Ù„Ø£ÙƒØ«Ø± Ø´Ø¹Ø¨ÙŠØ©</h3>
          <div id="popularArticles">
            <div class="admin-loading">
              <div class="admin-spinner"></div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª -->
      <div id="articlesSection" class="admin-section" style="display: none;">
        <div class="admin-section-header">
          <h2 class="admin-section-title"><i class="fas fa-newspaper"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª</h2>
          <div class="admin-filters">
            <input type="text" class="admin-form-control filter-input" id="articleSearch" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª...">
            <select class="admin-form-control filter-select" id="articleFilter">
              <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª</option>
              <option value="recent">Ø§Ù„Ø£Ø­Ø¯Ø«</option>
              <option value="popular">Ø§Ù„Ø£ÙƒØ«Ø± Ø´Ø¹Ø¨ÙŠØ©</option>
              <option value="flagged">Ø§Ù„Ù…Ø¨Ù„Øº Ø¹Ù†Ù‡Ø§</option>
            </select>
          </div>
        </div>
        
        <div class="admin-table-container">
          <table class="admin-table" id="articlesTable">
            <thead>
              <tr>
                <th>#</th>
                <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                <th>Ø§Ù„Ù†Ø§Ø´Ø±</th>
                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                <th>Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨Ø§Øª</th>
                <th>Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</th>
                <th>Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª</th>
                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
              </tr>
            </thead>
            <tbody id="articlesTableBody">
              <tr>
                <td colspan="8" class="admin-loading">
                  <div class="admin-spinner"></div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <div class="admin-pagination" id="articlesPagination">
          <!-- Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ±Ù‚ÙŠÙ… Ù‡Ù†Ø§ -->
        </div>
      </div>
      
      <!-- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† -->
      <div id="usersSection" class="admin-section" style="display: none;">
        <div class="admin-section-header">
          <h2 class="admin-section-title"><i class="fas fa-users"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h2>
          <div class="admin-filters">
            <input type="text" class="admin-form-control filter-input" id="userSearch" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†...">
            <button class="admin-btn primary" onclick="openCreateUserModal()">
              <i class="fas fa-user-plus"></i>
              <span>Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯</span>
            </button>
          </div>
        </div>
        
        <div class="admin-table-container">
          <table class="admin-table" id="usersTable">
            <thead>
              <tr>
                <th>#</th>
                <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                <th>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th>
                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…</th>
                <th>Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª</th>
                <th>Ø¢Ø®Ø± Ù†Ø´Ø§Ø·</th>
                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
              </tr>
            </thead>
            <tbody id="usersTableBody">
              <tr>
                <td colspan="8" class="admin-loading">
                  <div class="admin-spinner"></div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <div class="admin-pagination" id="usersPagination">
          <!-- Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ±Ù‚ÙŠÙ… Ù‡Ù†Ø§ -->
        </div>
      </div>
      
      <!-- Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
      <div id="reportsSection" class="admin-section" style="display: none;">
        <h2 class="admin-section-title"><i class="fas fa-chart-bar"></i> Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h2>
        
        <div class="admin-card">
          <h3><i class="fas fa-calendar-alt"></i> Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø´Ù‡Ø±</h3>
          <div id="monthlyStats">
            <div class="admin-loading">
              <div class="admin-spinner"></div>
            </div>
          </div>
        </div>
        
        <div class="admin-card">
          <h3><i class="fas fa-user-chart"></i> Ø£Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù†Ø´Ø§Ø·Ø§Ù‹</h3>
          <div id="topUsers">
            <div class="admin-loading">
              <div class="admin-spinner"></div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
      <div id="settingsSection" class="admin-section" style="display: none;">
        <h2 class="admin-section-title"><i class="fas fa-cog"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h2>
        
        <div class="admin-card">
          <h3><i class="fas fa-sliders-h"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</h3>
          
          <div class="admin-form-group">
            <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
            <input type="text" class="admin-form-control" id="siteTitle" value="Ù…Ù†ØªØ¯Ù‰ Ø§Ù„Ø±ÙŠØ¯Ø¨ÙŠÙ„">
          </div>
          
          <div class="admin-form-group">
            <label>ÙˆØµÙ Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
            <textarea class="admin-form-control" id="siteDescription" rows="3">Ù…Ù†ØªØ¯Ù‰ Ù…ØªØ®ØµØµ Ù„Ù„Ù…Ù†Ø§Ù‚Ø´Ø§Øª ÙˆØ§Ù„Ø£ÙÙƒØ§Ø±</textarea>
          </div>
          
          <div class="admin-form-group">
            <label>ÙØªØ±Ø© Ø§Ù„ØªØ¨Ø±ÙŠØ¯ Ù„Ù„Ù…Ù‚Ø§Ù„Ø§Øª (Ø³Ø§Ø¹Ø§Øª)</label>
            <input type="number" class="admin-form-control" id="articleCooldown" value="1" min="0.5" max="24" step="0.5">
          </div>
          
          <div class="admin-form-group">
            <label>ÙØªØ±Ø© Ø§Ù„ØªØ¨Ø±ÙŠØ¯ Ù„Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª (Ø¯Ù‚Ø§Ø¦Ù‚)</label>
            <input type="number" class="admin-form-control" id="commentCooldown" value="1" min="0.5" max="60" step="0.5">
          </div>
          
          <button class="admin-btn success" onclick="saveSettings()">
            <i class="fas fa-save"></i>
            <span>Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
          </button>
        </div>
      </div>
    </main>
  </div>
  
  <!-- ================= MODAL: ARTICLE DETAILS ================= -->
  <div class="admin-modal-overlay" id="articleDetailsModal">
    <div class="admin-modal">
      <div class="admin-modal-header">
        <h3><i class="fas fa-file-alt"></i> ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„</h3>
        <button class="admin-modal-close" onclick="closeArticleDetailsModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="admin-modal-content">
        <div id="articleDetailsContent">
          <!-- Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„ Ù‡Ù†Ø§ -->
        </div>
      </div>
    </div>
  </div>
  
  <!-- ================= MODAL: USER DETAILS ================= -->
  <div class="admin-modal-overlay" id="userDetailsModal">
    <div class="admin-modal">
      <div class="admin-modal-header">
        <h3><i class="fas fa-user"></i> ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h3>
        <button class="admin-modal-close" onclick="closeUserDetailsModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="admin-modal-content">
        <div id="userDetailsContent">
          <!-- Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‡Ù†Ø§ -->
        </div>
      </div>
    </div>
  </div>
  
  <!-- ================= MODAL: EDIT ARTICLE ================= -->
  <div class="admin-modal-overlay" id="editArticleModal">
    <div class="admin-modal">
      <div class="admin-modal-header">
        <h3><i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„</h3>
        <button class="admin-modal-close" onclick="closeEditArticleModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="admin-modal-content">
        <div id="editArticleContent">
          <!-- Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§ -->
        </div>
      </div>
    </div>
  </div>
  
  <!-- ================= MODAL: CREATE USER ================= -->
  <div class="admin-modal-overlay" id="createUserModal">
    <div class="admin-modal">
      <div class="admin-modal-header">
        <h3><i class="fas fa-user-plus"></i> Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯</h3>
        <button class="admin-modal-close" onclick="closeCreateUserModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="admin-modal-content">
        <div class="admin-form-group">
          <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
          <input type="email" class="admin-form-control" id="newUserEmail" placeholder="example@domain.com">
        </div>
        
        <div class="admin-form-group">
          <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
          <input type="password" class="admin-form-control" id="newUserPassword" placeholder="6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„">
        </div>
        
        <div class="admin-form-group">
          <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
          <input type="text" class="admin-form-control" id="newUsername" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
        </div>
        
        <div class="admin-form-group">
          <label>ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
          <select class="admin-form-control" id="newUserRole">
            <option value="user">Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø§Ø¯ÙŠ</option>
            <option value="admin">Ù…Ø´Ø±Ù</option>
            <option value="moderator">Ù…Ø±Ø§Ù‚Ø¨</option>
          </select>
        </div>
        
        <div class="admin-form-group">
          <button class="admin-btn primary" onclick="createNewUser()" id="createUserBtn">
            <i class="fas fa-user-plus"></i>
            <span>Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</span>
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ================= MODAL: CONFIRM DELETE ================= -->
  <div class="admin-modal-overlay" id="confirmDeleteModal">
    <div class="admin-modal" style="max-width: 400px;">
      <div class="admin-modal-header">
        <h3><i class="fas fa-exclamation-triangle"></i> ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù</h3>
        <button class="admin-modal-close" onclick="closeConfirmDeleteModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="admin-modal-content">
        <p id="deleteMessage">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ØµØ±ØŸ</p>
        <div style="display: flex; gap: 10px; margin-top: 20px;">
          <button class="admin-btn danger" id="confirmDeleteBtn">
            <i class="fas fa-trash"></i>
            <span>Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù</span>
          </button>
          <button class="admin-btn" onclick="closeConfirmDeleteModal()">
            <i class="fas fa-times"></i>
            <span>Ø¥Ù„ØºØ§Ø¡</span>
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ================= MODAL: BAN USER ================= -->
  <div class="admin-modal-overlay" id="banUserModal">
    <div class="admin-modal" style="max-width: 500px;">
      <div class="admin-modal-header">
        <h3><i class="fas fa-ban"></i> Ø­Ø¸Ø± Ù…Ø³ØªØ®Ø¯Ù…</h3>
        <button class="admin-modal-close" onclick="closeBanUserModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="admin-modal-content">
        <div class="admin-form-group">
          <label>Ø³Ø¨Ø¨ Ø§Ù„Ø­Ø¸Ø±</label>
          <select class="admin-form-control" id="banReason">
            <option value="spam">Ù†Ø´Ø± Ù…Ø­ØªÙˆÙ‰ ØºÙŠØ± Ù…Ø±ØºÙˆØ¨</option>
            <option value="abuse">Ø¥Ø³Ø§Ø¡Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø¸Ø§Ù…</option>
            <option value="violation">Ø§Ù†ØªÙ‡Ø§Ùƒ Ø§Ù„Ø´Ø±ÙˆØ·</option>
            <option value="other">Ø³Ø¨Ø¨ Ø¢Ø®Ø±</option>
          </select>
        </div>
        
        <div class="admin-form-group">
          <label>Ù…Ø¯Ø© Ø§Ù„Ø­Ø¸Ø±</label>
          <select class="admin-form-control" id="banDuration">
            <option value="1">ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯</option>
            <option value="7">Ø£Ø³Ø¨ÙˆØ¹</option>
            <option value="30">Ø´Ù‡Ø±</option>
            <option value="365">Ø³Ù†Ø©</option>
            <option value="permanent">Ø­Ø¸Ø± Ø¯Ø§Ø¦Ù…</option>
          </select>
        </div>
        
        <div class="admin-form-group">
          <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</label>
          <textarea class="admin-form-control" id="banNotes" rows="3" placeholder="ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ© Ø¹Ù† Ø³Ø¨Ø¨ Ø§Ù„Ø­Ø¸Ø±"></textarea>
        </div>
        
        <div class="admin-form-group">
          <button class="admin-btn danger" onclick="confirmBanUser()">
            <i class="fas fa-ban"></i>
            <span>ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¸Ø±</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ================= ADMIN NOTIFICATION ================= -->
  <div class="notification" id="adminNotification">
    <i class="fas fa-check-circle" id="adminNotificationIcon"></i>
    <span id="adminNotificationText"></span>
  </div>

  <script type="module">
  /* =====================================================
     FIREBASE IMPORTS
  ===================================================== */
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { 
    getAuth, 
    onAuthStateChanged, 
    signOut,
    deleteUser,
    listUsers,
    updateUser,
    createUserWithEmailAndPassword 
  } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
  import { 
    getDatabase, 
    ref, 
    push, 
    onValue, 
    update, 
    get, 
    set, 
    remove, 
    increment, 
    query, 
    orderByChild, 
    limitToLast, 
    limitToFirst,
    startAt,
    endAt 
  } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";
  
  /* =====================================================
     CONFIG
  ===================================================== */
  const firebaseConfig = {
    apiKey: "AIzaSyCdoubvkI7VEvYxtG3CzKFAJg74XXl7fX4",
    authDomain: "redpill-1c7e2.firebaseapp.com",
    databaseURL: "https://redpill-1c7e2-default-rtdb.firebaseio.com",
    projectId: "redpill-1c7e2",
    storageBucket: "redpill-1c7e2.firebasestorage.app",
    messagingSenderId: "337690521778",
    appId: "1:337690521778:web:ba3c99ad55e6b0d58f59ab"
  };
  
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getDatabase(app);
  
  // DOM Elements
  const adminLogoutBtn = document.getElementById('adminLogoutBtn');
  const adminSidebar = document.getElementById('adminSidebar');
  const adminOverlay = document.getElementById('adminOverlay');
  
  // Admin sections
  const dashboardSection = document.getElementById('dashboardSection');
  const articlesSection = document.getElementById('articlesSection');
  const usersSection = document.getElementById('usersSection');
  const reportsSection = document.getElementById('reportsSection');
  const settingsSection = document.getElementById('settingsSection');
  
  // Stats elements
  const totalUsers = document.getElementById('totalUsers');
  const totalArticles = document.getElementById('totalArticles');
  const totalComments = document.getElementById('totalComments');
  const totalLikes = document.getElementById('totalLikes');
  
  // Table elements
  const articlesTableBody = document.getElementById('articlesTableBody');
  const usersTableBody = document.getElementById('usersTableBody');
  
  // Pagination elements
  const articlesPagination = document.getElementById('articlesPagination');
  const usersPagination = document.getElementById('usersPagination');
  
  // Modal elements
  const articleDetailsModal = document.getElementById('articleDetailsModal');
  const userDetailsModal = document.getElementById('userDetailsModal');
  const editArticleModal = document.getElementById('editArticleModal');
  const createUserModal = document.getElementById('createUserModal');
  const confirmDeleteModal = document.getElementById('confirmDeleteModal');
  const banUserModal = document.getElementById('banUserModal');
  
  // Notification
  const adminNotification = document.getElementById('adminNotification');
  const adminNotificationIcon = document.getElementById('adminNotificationIcon');
  const adminNotificationText = document.getElementById('adminNotificationText');
  
  // Global variables
  let currentAdmin = null;
  let currentArticlePage = 1;
  let currentUserPage = 1;
  let articlesPerPage = 10;
  let usersPerPage = 10;
  let totalArticlesCount = 0;
  let totalUsersCount = 0;
  
  // Admin user IDs (Ø¶Ø¹ Ù‡Ù†Ø§ ID Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†)
  const ADMIN_USERS = [
    'd5ZG8G6n2hZ0BZBCzelTFP0DsPr2' // Ø¶Ø¹ Ù‡Ù†Ø§ UID Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù…Ù† Firebase Authentication
  ];
  
  /* =====================================================
     ADMIN AUTHENTICATION
  ===================================================== */
  onAuthStateChanged(auth, async (user) => {
    if (user) {
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø´Ø±ÙØ§Ù‹
      if (ADMIN_USERS.includes(user.uid)) {
        currentAdmin = user;
        loadDashboardStats();
        loadArticlesTable();
        loadUsersTable();
      } else {
        showAdminNotification('Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…', 'error');
        setTimeout(() => {
          location.href = 'index.html';
        }, 2000);
      }
    } else {
      // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…Ø³Ø¬Ù„Ø§Ù‹ØŒ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
      location.href = 'index.html';
    }
  });
  
  adminLogoutBtn.addEventListener('click', () => {
    signOut(auth).then(() => {
      location.href = 'index.html';
    });
  });
  
  /* =====================================================
     ADMIN NAVIGATION
  ===================================================== */
  window.showAdminSection = (sectionName) => {
    // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
    dashboardSection.style.display = 'none';
    articlesSection.style.display = 'none';
    usersSection.style.display = 'none';
    reportsSection.style.display = 'none';
    settingsSection.style.display = 'none';
    
    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø§Ø· Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
    document.querySelectorAll('.admin-menu-item').forEach(item => {
      item.classList.remove('active');
    });
    
    // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø­Ø¯Ø¯ ÙˆØ¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ø´Ø§Ø· Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
    switch(sectionName) {
      case 'dashboard':
        dashboardSection.style.display = 'block';
        document.querySelector('.admin-menu-item:nth-child(1)').classList.add('active');
        loadDashboardStats();
        break;
      case 'articles':
        articlesSection.style.display = 'block';
        document.querySelector('.admin-menu-item:nth-child(2)').classList.add('active');
        currentArticlePage = 1;
        loadArticlesTable();
        break;
      case 'users':
        usersSection.style.display = 'block';
        document.querySelector('.admin-menu-item:nth-child(3)').classList.add('active');
        currentUserPage = 1;
        loadUsersTable();
        break;
      case 'reports':
        reportsSection.style.display = 'block';
        document.querySelector('.admin-menu-item:nth-child(4)').classList.add('active');
        loadReports();
        break;
      case 'settings':
        settingsSection.style.display = 'block';
        document.querySelector('.admin-menu-item:nth-child(5)').classList.add('active');
        break;
    }
    
    closeAdminSidebar();
  };
  
  /* =====================================================
     SIDEBAR FUNCTIONS (Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø©)
  ===================================================== */
  function toggleAdminSidebar() {
    adminSidebar.classList.toggle('active');
    adminOverlay.classList.toggle('active');
  }
  
  function closeAdminSidebar() {
    if (window.innerWidth <= 992) {
      adminSidebar.classList.remove('active');
      adminOverlay.classList.remove('active');
    }
  }
  
  adminOverlay.addEventListener('click', closeAdminSidebar);
  
  window.addEventListener('resize', () => {
    if (window.innerWidth > 992) {
      adminSidebar.classList.remove('active');
      adminOverlay.classList.remove('active');
    }
  });
  
  /* =====================================================
     DASHBOARD STATISTICS
  ===================================================== */
  async function loadDashboardStats() {
    try {
      // ØªØ­Ù…ÙŠÙ„ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
      const usersRef = ref(db, 'users');
      const usersSnap = await get(usersRef);
      totalUsersCount = usersSnap.exists() ? Object.keys(usersSnap.val()).length : 0;
      totalUsers.textContent = totalUsersCount;
      
      // ØªØ­Ù…ÙŠÙ„ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª
      const articlesRef = ref(db, 'articles');
      const articlesSnap = await get(articlesRef);
      totalArticlesCount = articlesSnap.exists() ? Object.keys(articlesSnap.val()).length : 0;
      totalArticles.textContent = totalArticlesCount;
      
      // ØªØ­Ù…ÙŠÙ„ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª
      let commentsCount = 0;
      const commentsRef = ref(db, 'comments');
      const commentsSnap = await get(commentsRef);
      if (commentsSnap.exists()) {
        commentsSnap.forEach(category => {
          commentsCount += Object.keys(category.val()).length;
        });
      }
      totalComments.textContent = commentsCount;
      
      // ØªØ­Ù…ÙŠÙ„ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨Ø§Øª
      let likesCount = 0;
      const likesRef = ref(db, 'likes');
      const likesSnap = await get(likesRef);
      if (likesSnap.exists()) {
        likesSnap.forEach(article => {
          likesCount += Object.keys(article.val()).length;
        });
      }
      totalLikes.textContent = likesCount;
      
      // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©
      loadPopularArticles();
      
      // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„ÙŠÙˆÙ…ÙŠ
      loadDailyActivity();
      
    } catch (error) {
      console.error('Error loading dashboard stats:', error);
      showAdminNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª', 'error');
    }
  }
  
  async function loadPopularArticles() {
    try {
      const articlesRef = ref(db, 'articles');
      const articlesQuery = query(articlesRef, orderByChild('likesCount'), limitToLast(5));
      const snap = await get(articlesQuery);
      
      const popularArticlesDiv = document.getElementById('popularArticles');
      popularArticlesDiv.innerHTML = '';
      
      if (!snap.exists()) {
        popularArticlesDiv.innerHTML = '<div class="admin-empty-state"><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‚Ø§Ù„Ø§Øª Ø¨Ø¹Ø¯</p></div>';
        return;
      }
      
      const articles = [];
      snap.forEach(articleSnap => {
        articles.push({
          id: articleSnap.key,
          ...articleSnap.val()
        });
      });
      
      // ØªØ±ØªÙŠØ¨ ØªÙ†Ø§Ø²Ù„ÙŠ Ø­Ø³Ø¨ Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨Ø§Øª
      articles.sort((a, b) => b.likesCount - a.likesCount);
      
      let html = '<div style="display: flex; flex-direction: column; gap: 10px;">';
      articles.forEach(article => {
        html += `
          <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: rgba(255,255,255,0.03); border-radius: var(--radius-sm);">
            <div style="flex: 1;">
              <div style="font-weight: 600; font-size: 14px;">${article.title || 'Ø¹Ù†ÙˆØ§Ù† ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
              <div style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">
                ${formatDate(article.created)} â€¢ ${article.likesCount || 0} Ø¥Ø¹Ø¬Ø§Ø¨
              </div>
            </div>
            <div>
              <button class="admin-btn xsmall" onclick="viewArticleDetails('${article.id}')">
                <i class="fas fa-eye"></i>
              </button>
            </div>
          </div>
        `;
      });
      html += '</div>';
      
      popularArticlesDiv.innerHTML = html;
      
    } catch (error) {
      console.error('Error loading popular articles:', error);
    }
  }
  
  async function loadDailyActivity() {
    const dailyActivityDiv = document.getElementById('dailyActivity');
    
    try {
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      const todayTimestamp = today.getTime();
      
      // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø© Ø§Ù„ÙŠÙˆÙ…
      const articlesRef = ref(db, 'articles');
      const articlesQuery = query(articlesRef, orderByChild('created'), startAt(todayTimestamp));
      const articlesSnap = await get(articlesQuery);
      const articlesToday = articlesSnap.exists() ? Object.keys(articlesSnap.val()).length : 0;
      
      // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯ Ø§Ù„ÙŠÙˆÙ…
      const usersRef = ref(db, 'users');
      const usersSnap = await get(usersRef);
      let usersToday = 0;
      if (usersSnap.exists()) {
        usersSnap.forEach(user => {
          if (user.val().joinDate >= todayTimestamp) {
            usersToday++;
          }
        });
      }
      
      dailyActivityDiv.innerHTML = `
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
          <div style="text-align: center;">
            <div style="font-size: 24px; font-weight: 700; color: var(--green);">${articlesToday}</div>
            <div style="font-size: 13px; color: var(--text-muted); margin-top: 5px;">Ù…Ù‚Ø§Ù„Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</div>
          </div>
          <div style="text-align: center;">
            <div style="font-size: 24px; font-weight: 700; color: var(--blue);">${usersToday}</div>
            <div style="font-size: 13px; color: var(--text-muted); margin-top: 5px;">Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¬Ø¯Ø¯</div>
          </div>
        </div>
        <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border);">
          <div style="font-size: 13px; color: var(--text-muted);">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${new Date().toLocaleTimeString('ar-SA')}</div>
        </div>
      `;
      
    } catch (error) {
      dailyActivityDiv.innerHTML = '<div class="admin-empty-state"><p>Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„ÙŠÙˆÙ…ÙŠ</p></div>';
    }
  }
  
  /* =====================================================
     ARTICLES MANAGEMENT
  ===================================================== */
  async function loadArticlesTable(page = 1) {
    try {
      articlesTableBody.innerHTML = '<tr><td colspan="8" class="admin-loading"><div class="admin-spinner"></div></td></tr>';
      
      const articlesRef = ref(db, 'articles');
      const articlesQuery = query(articlesRef, orderByChild('created'));
      const snap = await get(articlesQuery);
      
      if (!snap.exists()) {
        articlesTableBody.innerHTML = '<tr><td colspan="8" class="admin-empty-state"><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‚Ø§Ù„Ø§Øª</p></td></tr>';
        return;
      }
      
      const allArticles = [];
      snap.forEach(articleSnap => {
        const article = {
          id: articleSnap.key,
          ...articleSnap.val()
        };
        allArticles.push(article);
      });
      
      // ØªØ±ØªÙŠØ¨ ØªÙ†Ø§Ø²Ù„ÙŠ Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ®
      allArticles.sort((a, b) => b.created - a.created);
      totalArticlesCount = allArticles.length;
      
      // Ø§Ù„ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø¨Ø­Ø«
      const searchTerm = document.getElementById('articleSearch').value.toLowerCase();
      const filterType = document.getElementById('articleFilter').value;
      
      let filteredArticles = allArticles;
      
      if (searchTerm) {
        filteredArticles = allArticles.filter(article => 
          article.title.toLowerCase().includes(searchTerm) ||
          (article.content && article.content.toLowerCase().includes(searchTerm))
        );
      }
      
      if (filterType === 'popular') {
        filteredArticles.sort((a, b) => b.likesCount - a.likesCount);
      } else if (filterType === 'recent') {
        filteredArticles.sort((a, b) => b.created - a.created);
      }
      
      // Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ±Ù‚ÙŠÙ…
      const totalPages = Math.ceil(filteredArticles.length / articlesPerPage);
      const startIndex = (page - 1) * articlesPerPage;
      const endIndex = startIndex + articlesPerPage;
      const pageArticles = filteredArticles.slice(startIndex, endIndex);
      
      // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª
      articlesTableBody.innerHTML = '';
      
      if (pageArticles.length === 0) {
        articlesTableBody.innerHTML = '<tr><td colspan="8" class="admin-empty-state"><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‚Ø§Ù„Ø§Øª</p></td></tr>';
        return;
      }
      
      let counter = startIndex + 1;
      for (const article of pageArticles) {
        const userData = await getUserData(article.author);
        const username = userData ? userData.username : 'Ù…Ø¬Ù‡ÙˆÙ„';
        
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${counter}</td>
          <td>
            <div style="font-weight: 600; font-size: 13px;">${article.title || 'Ø¹Ù†ÙˆØ§Ù† ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
            <div style="font-size: 11px; color: var(--text-muted); margin-top: 2px;">
              ${article.category || 'ØºÙŠØ± Ù…ØµÙ†Ù'} â€¢ ${article.readTime || '1'} Ø¯Ù‚ÙŠÙ‚Ø© Ù‚Ø±Ø§Ø¡Ø©
            </div>
          </td>
          <td>
            <div style="display: flex; align-items: center; gap: 8px;">
              <div style="width: 30px; height: 30px; border-radius: 50%; background: #333; display: flex; align-items: center; justify-content: center;">
                ${username[0] || '?'}
              </div>
              <span style="font-size: 13px;">${username}</span>
            </div>
          </td>
          <td>${formatShortDate(article.created)}</td>
          <td><span class="user-badge">${article.likesCount || 0}</span></td>
          <td><span class="user-badge">${article.commentsCount || 0}</span></td>
          <td><span class="user-badge">${article.viewsCount || 0}</span></td>
          <td>
            <div class="actions">
              <button class="admin-btn xsmall primary" onclick="viewArticleDetails('${article.id}')">
                <i class="fas fa-eye"></i>
              </button>
              <button class="admin-btn xsmall warning" onclick="editArticle('${article.id}')">
                <i class="fas fa-edit"></i>
              </button>
              <button class="admin-btn xsmall danger" onclick="confirmDeleteArticle('${article.id}')">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </td>
        `;
        articlesTableBody.appendChild(row);
        counter++;
      }
      
      // Ø¥Ù†Ø´Ø§Ø¡ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ±Ù‚ÙŠÙ…
      createPagination(articlesPagination, page, totalPages, 'articles');
      
    } catch (error) {
      console.error('Error loading articles table:', error);
      showAdminNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª', 'error');
    }
  }
  
  // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹Ø§Øª Ù„Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ©
  document.getElementById('articleSearch').addEventListener('input', () => {
    currentArticlePage = 1;
    loadArticlesTable(1);
  });
  
  document.getElementById('articleFilter').addEventListener('change', () => {
    currentArticlePage = 1;
    loadArticlesTable(1);
  });
  
  window.viewArticleDetails = async (articleId) => {
    try {
      const articleRef = ref(db, `articles/${articleId}`);
      const articleSnap = await get(articleRef);
      
      if (!articleSnap.exists()) {
        showAdminNotification('Ø§Ù„Ù…Ù‚Ø§Ù„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
        return;
      }
      
      const article = articleSnap.val();
      const userData = await getUserData(article.author);
      const username = userData ? userData.username : 'Ù…Ø¬Ù‡ÙˆÙ„';
      
      let tagsHTML = '';
      if (article.likesCount > 10) {
        tagsHTML += '<span class="user-badge" style="margin-left: 5px;">ğŸ”¥ Ø´Ø§Ø¦Ø¹</span>';
      }
      if (Date.now() - article.created < 24 * 60 * 60 * 1000) {
        tagsHTML += '<span class="user-badge" style="margin-left: 5px;">ğŸ†• Ø¬Ø¯ÙŠØ¯</span>';
      }
      if (article.category) {
        tagsHTML += `<span class="user-badge" style="margin-left: 5px;">${article.category}</span>`;
      }
      
      const content = document.getElementById('articleDetailsContent');
      content.innerHTML = `
        <div class="user-details">
          <div class="user-header">
            <div class="user-avatar">${username[0] || '?'}</div>
            <div class="user-info">
              <h3>${username}</h3>
              <div class="email">${article.author}</div>
            </div>
          </div>
          
          <div style="margin-bottom: 15px;">
            <h4 style="font-size: 16px; margin-bottom: 10px;">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„</h4>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
              <div>
                <div style="font-size: 12px; color: var(--text-muted);">Ø§Ù„ØªØ§Ø±ÙŠØ®</div>
                <div style="font-weight: 600;">${formatDate(article.created)}</div>
              </div>
              <div>
                <div style="font-size: 12px; color: var(--text-muted);">Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨Ø§Øª</div>
                <div style="font-weight: 600;">${article.likesCount || 0}</div>
              </div>
              <div>
                <div style="font-size: 12px; color: var(--text-muted);">Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</div>
                <div style="font-weight: 600;">${article.commentsCount || 0}</div>
              </div>
              <div>
                <div style="font-size: 12px; color: var(--text-muted);">Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª</div>
                <div style="font-weight: 600;">${article.viewsCount || 0}</div>
              </div>
            </div>
          </div>
          
          <div style="margin-bottom: 15px;">
            <h4 style="font-size: 16px; margin-bottom: 10px;">${article.title}</h4>
            <div>${tagsHTML}</div>
          </div>
          
          <div style="margin-bottom: 20px;">
            <h4 style="font-size: 14px; margin-bottom: 10px; color: var(--text-muted);">Ø§Ù„Ù…Ø­ØªÙˆÙ‰</h4>
            <div style="background: rgba(255,255,255,0.03); padding: 15px; border-radius: var(--radius-sm); font-size: 14px; line-height: 1.6;">
              ${article.content || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­ØªÙˆÙ‰'}
            </div>
          </div>
          
          <div style="display: flex; gap: 10px;">
            <button class="admin-btn primary" onclick="editArticle('${articleId}')">
              <i class="fas fa-edit"></i>
              <span>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„</span>
            </button>
            <button class="admin-btn danger" onclick="confirmDeleteArticle('${articleId}')">
              <i class="fas fa-trash"></i>
              <span>Ø­Ø°Ù Ø§Ù„Ù…Ù‚Ø§Ù„</span>
            </button>
          </div>
        </div>
      `;
      
      articleDetailsModal.style.display = 'flex';
      
    } catch (error) {
      console.error('Error loading article details:', error);
      showAdminNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„', 'error');
    }
  };
  
  window.closeArticleDetailsModal = () => {
    articleDetailsModal.style.display = 'none';
  };
  
  window.editArticle = async (articleId) => {
    try {
      const articleRef = ref(db, `articles/${articleId}`);
      const articleSnap = await get(articleRef);
      
      if (!articleSnap.exists()) {
        showAdminNotification('Ø§Ù„Ù…Ù‚Ø§Ù„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
        return;
      }
      
      const article = articleSnap.val();
      
      const content = document.getElementById('editArticleContent');
      content.innerHTML = `
        <div class="admin-form-group">
          <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‚Ø§Ù„</label>
          <input type="text" class="admin-form-control" id="editArticleTitle" value="${article.title || ''}" maxlength="70">
        </div>
        
        <div class="admin-form-group">
          <label>Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù‚Ø§Ù„</label>
          <textarea class="admin-form-control" id="editArticleContent" rows="6" maxlength="2000">${article.content || ''}</textarea>
        </div>
        
        <div class="admin-form-group">
          <label>Ø§Ù„ØªØµÙ†ÙŠÙ</label>
          <select class="admin-form-control" id="editArticleCategory">
            <option value="Ø±ÙŠØ¯Ø¨ÙŠÙ„" ${article.category === 'Ø±ÙŠØ¯Ø¨ÙŠÙ„' ? 'selected' : ''}>Ø±ÙŠØ¯Ø¨ÙŠÙ„</option>
            <option value="Ø¨Ù„Ø§Ùƒ Ø¨ÙŠÙ„" ${article.category === 'Ø¨Ù„Ø§Ùƒ Ø¨ÙŠÙ„' ? 'selected' : ''}>Ø¨Ù„Ø§Ùƒ Ø¨ÙŠÙ„</option>
            <option value="ØºÙŠØ± Ù…ØµÙ†Ù" ${article.category === 'ØºÙŠØ± Ù…ØµÙ†Ù' ? 'selected' : ''}>ØºÙŠØ± Ù…ØµÙ†Ù</option>
          </select>
        </div>
        
        <div class="admin-form-group">
          <label>ÙˆÙ‚Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</label>
          <select class="admin-form-control" id="editArticleReadTime">
            <option value="1" ${article.readTime === '1' ? 'selected' : ''}>Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ§Ø­Ø¯Ø©</option>
            <option value="3" ${article.readTime === '3' ? 'selected' : ''}>Ù£ Ø¯Ù‚Ø§Ø¦Ù‚</option>
            <option value="5" ${article.readTime === '5' ? 'selected' : ''}>Ù¥ Ø¯Ù‚Ø§Ø¦Ù‚</option>
            <option value="10" ${article.readTime === '10' ? 'selected' : ''}>Ù¡Ù  Ø¯Ù‚Ø§Ø¦Ù‚</option>
            <option value="15" ${article.readTime === '15' ? 'selected' : ''}>Ù¡Ù¥ Ø¯Ù‚ÙŠÙ‚Ø©</option>
          </select>
        </div>
        
        <div class="admin-form-group" style="display: flex; gap: 10px;">
          <button class="admin-btn success" onclick="saveArticleEdit('${articleId}')" id="saveArticleBtn">
            <i class="fas fa-save"></i>
            <span>Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</span>
          </button>
          <button class="admin-btn" onclick="closeEditArticleModal()">
            <i class="fas fa-times"></i>
            <span>Ø¥Ù„ØºØ§Ø¡</span>
          </button>
        </div>
      `;
      
      editArticleModal.style.display = 'flex';
      
    } catch (error) {
      console.error('Error loading article for edit:', error);
      showAdminNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„', 'error');
    }
  };
  
  window.saveArticleEdit = async (articleId) => {
    const title = document.getElementById('editArticleTitle').value.trim();
    const content = document.getElementById('editArticleContent').value.trim();
    const category = document.getElementById('editArticleCategory').value;
    const readTime = document.getElementById('editArticleReadTime').value;
    
    if (!title || !content) {
      showAdminNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', 'error');
      return;
    }
    
    if (title.length < 5) {
      showAdminNotification('Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‚Ø§Ù„ Ù‚ØµÙŠØ± Ø¬Ø¯Ø§Ù‹', 'error');
      return;
    }
    
    if (content.length < 50) {
      showAdminNotification('Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù‚Ø§Ù„ Ù‚ØµÙŠØ± Ø¬Ø¯Ø§Ù‹', 'error');
      return;
    }
    
    try {
      const btn = document.getElementById('saveArticleBtn');
      btn.disabled = true;
      btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
      
      await update(ref(db, `articles/${articleId}`), {
        title: title,
        content: content,
        category: category,
        readTime: readTime,
        updated: Date.now(),
        updatedBy: currentAdmin.uid
      });
      
      showAdminNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù‚Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
      closeEditArticleModal();
      loadArticlesTable(currentArticlePage);
      
    } catch (error) {
      console.error('Error updating article:', error);
      showAdminNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù‚Ø§Ù„', 'error');
    } finally {
      const btn = document.getElementById('saveArticleBtn');
      btn.disabled = false;
      btn.innerHTML = '<i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª';
    }
  };
  
  window.closeEditArticleModal = () => {
    editArticleModal.style.display = 'none';
  };
  
  window.confirmDeleteArticle = (articleId) => {
    const deleteMessage = document.getElementById('deleteMessage');
    deleteMessage.textContent = 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù‚Ø§Ù„ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª ÙˆØ§Ù„Ø¥Ø¹Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‡.';
    
    const confirmBtn = document.getElementById('confirmDeleteBtn');
    confirmBtn.onclick = () => deleteArticle(articleId);
    
    confirmDeleteModal.style.display = 'flex';
  };
  
  async function deleteArticle(articleId) {
    try {
      // Ø­Ø°Ù Ø§Ù„Ù…Ù‚Ø§Ù„
      await remove(ref(db, `articles/${articleId}`));
      
      // Ø­Ø°Ù Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨Ø§Øª
      await remove(ref(db, `likes/${articleId}`));
      
      // Ø­Ø°Ù Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª
      await remove(ref(db, `comments/${articleId}`));
      
      // Ø­Ø°Ù Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª
      await remove(ref(db, `views/${articleId}`));
      
      showAdminNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù‚Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
      closeConfirmDeleteModal();
      loadArticlesTable(currentArticlePage);
      loadDashboardStats();
      
    } catch (error) {
      console.error('Error deleting article:', error);
      showAdminNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ù…Ù‚Ø§Ù„', 'error');
    }
  }
  
  /* =====================================================
     USERS MANAGEMENT
  ===================================================== */
  async function loadUsersTable(page = 1) {
    try {
      usersTableBody.innerHTML = '<tr><td colspan="8" class="admin-loading"><div class="admin-spinner"></div></td></tr>';
      
      // Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      const usersRef = ref(db, 'users');
      const usersSnap = await get(usersRef);
      
      if (!usersSnap.exists()) {
        usersTableBody.innerHTML = '<tr><td colspan="8" class="admin-empty-state"><p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</p></td></tr>';
        return;
      }
      
      const allUsers = [];
      usersSnap.forEach(userSnap => {
        const user = {
          id: userSnap.key,
          ...userSnap.val()
        };
        allUsers.push(user);
      });
      
      // Ø§Ù„ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø¨Ø­Ø«
      const searchTerm = document.getElementById('userSearch').value.toLowerCase();
      
      let filteredUsers = allUsers;
      
      if (searchTerm) {
        filteredUsers = allUsers.filter(user => 
          user.username.toLowerCase().includes(searchTerm) ||
          user.email.toLowerCase().includes(searchTerm)
        );
      }
      
      // Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ±Ù‚ÙŠÙ…
      const totalPages = Math.ceil(filteredUsers.length / usersPerPage);
      const startIndex = (page - 1) * usersPerPage;
      const endIndex = startIndex + usersPerPage;
      const pageUsers = filteredUsers.slice(startIndex, endIndex);
      
      // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
      usersTableBody.innerHTML = '';
      
      if (pageUsers.length === 0) {
        usersTableBody.innerHTML = '<tr><td colspan="8" class="admin-empty-state"><p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</p></td></tr>';
        return;
      }
      
      let counter = startIndex + 1;
      for (const user of pageUsers) {
        const isAdmin = ADMIN_USERS.includes(user.id);
        const status = isAdmin ? 'admin' : 'active';
        
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${counter}</td>
          <td>
            <div style="display: flex; align-items: center; gap: 8px;">
              <div style="width: 30px; height: 30px; border-radius: 50%; background: #333; display: flex; align-items: center; justify-content: center;">
                ${user.username[0] || '?'}
              </div>
              <div>
                <div style="font-weight: 600; font-size: 13px;">${user.username || 'Ù…Ø³ØªØ®Ø¯Ù…'}</div>
                <div style="font-size: 11px; color: var(--text-muted);">ID: ${user.id.substring(0, 8)}...</div>
              </div>
            </div>
          </td>
          <td>${user.email || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
          <td>${formatShortDate(user.joinDate)}</td>
          <td><span class="user-badge">${user.articlesCount || 0}</span></td>
          <td>${formatDate(user.lastLogin || user.joinDate)}</td>
          <td>
            <span class="user-badge ${isAdmin ? 'admin' : ''}">
              ${isAdmin ? 'Ù…Ø´Ø±Ù' : 'Ù†Ø´Ø·'}
            </span>
          </td>
          <td>
            <div class="actions">
              <button class="admin-btn xsmall primary" onclick="viewUserDetails('${user.id}')">
                <i class="fas fa-eye"></i>
              </button>
              ${!isAdmin ? `
              <button class="admin-btn xsmall warning" onclick="openBanUserModal('${user.id}')">
                <i class="fas fa-ban"></i>
              </button>
              <button class="admin-btn xsmall danger" onclick="confirmDeleteUser('${user.id}')">
                <i class="fas fa-trash"></i>
              </button>
              ` : ''}
            </div>
          </td>
        `;
        usersTableBody.appendChild(row);
        counter++;
      }
      
      // Ø¥Ù†Ø´Ø§Ø¡ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ±Ù‚ÙŠÙ…
      createPagination(usersPagination, page, totalPages, 'users');
      
    } catch (error) {
      console.error('Error loading users table:', error);
      showAdminNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†', 'error');
    }
  }
  
  // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ù„Ù„Ø¨Ø­Ø«
  document.getElementById('userSearch').addEventListener('input', () => {
    currentUserPage = 1;
    loadUsersTable(1);
  });
  
  window.viewUserDetails = async (userId) => {
    try {
      const userRef = ref(db, `users/${userId}`);
      const userSnap = await get(userRef);
      
      if (!userSnap.exists()) {
        showAdminNotification('Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
        return;
      }
      
      const userData = userSnap.val();
      userData.id = userId;
      
      // Ø¬Ù„Ø¨ Ù…Ù‚Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      const articlesRef = ref(db, 'articles');
      const articlesSnap = await get(articlesRef);
      let userArticles = 0;
      let totalLikes = 0;
      let totalComments = 0;
      
      if (articlesSnap.exists()) {
        articlesSnap.forEach(articleSnap => {
          const article = articleSnap.val();
          if (article.author === userId) {
            userArticles++;
            totalLikes += article.likesCount || 0;
            totalComments += article.commentsCount || 0;
          }
        });
      }
      
      const content = document.getElementById('userDetailsContent');
      content.innerHTML = `
        <div class="user-details">
          <div class="user-header">
            <div class="user-avatar">${userData.username[0] || '?'}</div>
            <div class="user-info">
              <h3>${userData.username || 'Ù…Ø³ØªØ®Ø¯Ù…'}</h3>
              <div class="email">${userData.email || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
            </div>
          </div>
          
          <div style="margin-bottom: 15px;">
            <h4 style="font-size: 16px; margin-bottom: 10px;">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h4>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;">
              <div>
                <div style="font-size: 12px; color: var(--text-muted);">Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª</div>
                <div style="font-weight: 600; font-size: 18px;">${userArticles}</div>
              </div>
              <div>
                <div style="font-size: 12px; color: var(--text-muted);">Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨Ø§Øª</div>
                <div style="font-weight: 600; font-size: 18px;">${totalLikes}</div>
              </div>
              <div>
                <div style="font-size: 12px; color: var(--text-muted);">Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</div>
                <div style="font-weight: 600; font-size: 18px;">${totalComments}</div>
              </div>
              <div>
                <div style="font-size: 12px; color: var(--text-muted);">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</div>
                <div style="font-weight: 600; font-size: 18px;">
                  ${Math.round((userArticles + totalLikes + totalComments) / 10)}
                </div>
              </div>
            </div>
          </div>
          
          <div style="margin-bottom: 20px;">
            <h4 style="font-size: 16px; margin-bottom: 10px;">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
              <div>
                <div style="font-size: 12px; color: var(--text-muted);">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…</div>
                <div style="font-weight: 600;">${formatDate(userData.joinDate)}</div>
              </div>
              <div>
                <div style="font-size: 12px; color: var(--text-muted);">Ø¢Ø®Ø± ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</div>
                <div style="font-weight: 600;">${formatDate(userData.lastLogin || userData.joinDate)}</div>
              </div>
              <div>
                <div style="font-size: 12px; color: var(--text-muted);">Ø¢Ø®Ø± Ù…Ù‚Ø§Ù„</div>
                <div style="font-weight: 600;">${userData.lastArticle ? formatDate(userData.lastArticle) : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}</div>
              </div>
              <div>
                <div style="font-size: 12px; color: var(--text-muted);">Ø¢Ø®Ø± ØªØ¹Ù„ÙŠÙ‚</div>
                <div style="font-weight: 600;">${userData.lastComment ? formatDate(userData.lastComment) : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}</div>
              </div>
            </div>
          </div>
          
          <div style="margin-bottom: 20px;">
            <h4 style="font-size: 16px; margin-bottom: 10px;">Ø§Ù„Ù†Ø¨Ø°Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©</h4>
            <div style="background: rgba(255,255,255,0.03); padding: 15px; border-radius: var(--radius-sm);">
              ${userData.bio || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø¨Ø°Ø© Ø´Ø®ØµÙŠØ©'}
            </div>
          </div>
          
          <div style="display: flex; gap: 10px;">
            ${!ADMIN_USERS.includes(userId) ? `
            <button class="admin-btn warning" onclick="openBanUserModal('${userId}')">
              <i class="fas fa-ban"></i>
              <span>Ø­Ø¸Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</span>
            </button>
            <button class="admin-btn danger" onclick="confirmDeleteUser('${userId}')">
              <i class="fas fa-trash"></i>
              <span>Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨</span>
            </button>
            ` : '<div style="color: var(--text-muted); font-size: 14px;">Ù‡Ø°Ø§ Ø­Ø³Ø§Ø¨ Ù…Ø´Ø±Ù Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„Ù‡</div>'}
          </div>
        </div>
      `;
      
      userDetailsModal.style.display = 'flex';
      
    } catch (error) {
      console.error('Error loading user details:', error);
      showAdminNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'error');
    }
  };
  
  window.closeUserDetailsModal = () => {
    userDetailsModal.style.display = 'none';
  };
  
  window.openBanUserModal = (userId) => {
    const content = document.getElementById('banUserModal');
    content.setAttribute('data-user-id', userId);
    banUserModal.style.display = 'flex';
  };
  
  window.closeBanUserModal = () => {
    banUserModal.style.display = 'none';
  };
  
  window.confirmBanUser = async () => {
    const userId = document.getElementById('banUserModal').getAttribute('data-user-id');
    const reason = document.getElementById('banReason').value;
    const duration = document.getElementById('banDuration').value;
    const notes = document.getElementById('banNotes').value.trim();
    
    try {
      await set(ref(db, `admin/bans/${userId}`), {
        reason: reason,
        duration: duration,
        notes: notes,
        bannedAt: Date.now(),
        bannedBy: currentAdmin.uid
      });
      
      showAdminNotification('ØªÙ… Ø­Ø¸Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');
      closeBanUserModal();
      loadUsersTable(currentUserPage);
      
    } catch (error) {
      console.error('Error banning user:', error);
      showAdminNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø¸Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'error');
    }
  };
  
  window.confirmDeleteUser = (userId) => {
    if (ADMIN_USERS.includes(userId)) {
      showAdminNotification('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø­Ø³Ø§Ø¨ Ù…Ø´Ø±Ù', 'error');
      return;
    }
    
    const deleteMessage = document.getElementById('deleteMessage');
    deleteMessage.textContent = 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ù…Ù‚Ø§Ù„Ø§ØªÙ‡ ÙˆØªØ¹Ù„ÙŠÙ‚Ø§ØªÙ‡ ÙˆØ¥Ø¹Ø¬Ø§Ø¨Ø§ØªÙ‡ Ø¨Ø´ÙƒÙ„ Ø¯Ø§Ø¦Ù….';
    
    const confirmBtn = document.getElementById('confirmDeleteBtn');
    confirmBtn.onclick = () => deleteUserAccount(userId);
    
    confirmDeleteModal.style.display = 'flex';
  };
  
  async function deleteUserAccount(userId) {
    try {
      // 1. Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ù…Ù‚Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      const articlesRef = ref(db, 'articles');
      const articlesSnap = await get(articlesRef);
      
      if (articlesSnap.exists()) {
        const deletePromises = [];
        articlesSnap.forEach(articleSnap => {
          const article = articleSnap.val();
          if (article.author === userId) {
            deletePromises.push(remove(ref(db, `articles/${articleSnap.key}`)));
            deletePromises.push(remove(ref(db, `likes/${articleSnap.key}`)));
            deletePromises.push(remove(ref(db, `comments/${articleSnap.key}`)));
            deletePromises.push(remove(ref(db, `views/${articleSnap.key}`)));
          }
        });
        await Promise.all(deletePromises);
      }
      
      // 2. Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      const commentsRef = ref(db, 'comments');
      const commentsSnap = await get(commentsRef);
      
      if (commentsSnap.exists()) {
        const commentPromises = [];
        commentsSnap.forEach(categorySnap => {
          categorySnap.forEach(commentSnap => {
            const comment = commentSnap.val();
            if (comment.author === userId) {
              commentPromises.push(remove(ref(db, `comments/${categorySnap.key}/${commentSnap.key}`)));
            }
          });
        });
        await Promise.all(commentPromises);
      }
      
      // 3. Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø¥Ø¹Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      const likesRef = ref(db, 'likes');
      const likesSnap = await get(likesRef);
      
      if (likesSnap.exists()) {
        const likePromises = [];
        likesSnap.forEach(articleSnap => {
          articleSnap.forEach(likeSnap => {
            if (likeSnap.key === userId) {
              likePromises.push(remove(ref(db, `likes/${articleSnap.key}/${userId}`)));
            }
          });
        });
        await Promise.all(likePromises);
      }
      
      // 4. Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      await remove(ref(db, `users/${userId}`));
      
      // 5. Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ù† Authentication (ÙŠØªØ·Ù„Ø¨ Ø£Ø°ÙˆÙ†Ø§Øª Ø®Ø§ØµØ©)
      // Note: ÙÙŠ Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©ØŒ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… Cloud Functions Ø£Ùˆ Firebase Admin SDK
      
      showAdminNotification('ØªÙ… Ø­Ø°Ù Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');
      closeConfirmDeleteModal();
      loadUsersTable(currentUserPage);
      loadDashboardStats();
      
    } catch (error) {
      console.error('Error deleting user account:', error);
      showAdminNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'error');
    }
  }
  
  window.closeConfirmDeleteModal = () => {
    confirmDeleteModal.style.display = 'none';
  };
  
  /* =====================================================
     CREATE NEW USER
  ===================================================== */
  window.openCreateUserModal = () => {
    createUserModal.style.display = 'flex';
  };
  
  window.closeCreateUserModal = () => {
    createUserModal.style.display = 'none';
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„
    document.getElementById('newUserEmail').value = '';
    document.getElementById('newUserPassword').value = '';
    document.getElementById('newUsername').value = '';
    document.getElementById('newUserRole').value = 'user';
  };
  
  window.createNewUser = async () => {
    const email = document.getElementById('newUserEmail').value.trim();
    const password = document.getElementById('newUserPassword').value.trim();
    const username = document.getElementById('newUsername').value.trim();
    const role = document.getElementById('newUserRole').value;
    
    if (!email || !password || !username) {
      showAdminNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', 'error');
      return;
    }
    
    if (password.length < 6) {
      showAdminNotification('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'error');
      return;
    }
    
    if (username.length < 3) {
      showAdminNotification('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 3 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'error');
      return;
    }
    
    try {
      const btn = document.getElementById('createUserBtn');
      btn.disabled = true;
      btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...';
      
      // Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ ÙÙŠ Authentication
      const userCredential = await createUserWithEmailAndPassword(auth, email, password);
      const newUserId = userCredential.user.uid;
      
      // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      await set(ref(db, `users/${newUserId}`), {
        username: username,
        email: email,
        role: role,
        joinDate: Date.now(),
        lastLogin: Date.now(),
        articlesCount: 0,
        likesCount: 0,
        commentsCount: 0,
        lastArticle: 0,
        lastComment: 0,
        bio: 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ù…Ø´Ø±Ù'
      });
      
      showAdminNotification('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');
      closeCreateUserModal();
      loadUsersTable(currentUserPage);
      loadDashboardStats();
      
    } catch (error) {
      console.error('Error creating user:', error);
      
      if (error.code === 'auth/email-already-in-use') {
        showAdminNotification('Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„', 'error');
      } else if (error.code === 'auth/invalid-email') {
        showAdminNotification('Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­', 'error');
      } else if (error.code === 'auth/weak-password') {
        showAdminNotification('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ© Ø¬Ø¯Ø§Ù‹', 'error');
      } else {
        showAdminNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨', 'error');
      }
    } finally {
      const btn = document.getElementById('createUserBtn');
      btn.disabled = false;
      btn.innerHTML = '<i class="fas fa-user-plus"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨';
    }
  };
  
  /* =====================================================
     REPORTS
  ===================================================== */
  async function loadReports() {
    try {
      // ØªØ­Ù…ÙŠÙ„ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø´Ù‡Ø±
      const monthlyStatsDiv = document.getElementById('monthlyStats');
      const topUsersDiv = document.getElementById('topUsers');
      
      // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
      
      monthlyStatsDiv.innerHTML = `
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
          <div style="text-align: center;">
            <div style="font-size: 20px; font-weight: 700; color: var(--green);">${totalArticlesCount}</div>
            <div style="font-size: 13px; color: var(--text-muted); margin-top: 5px;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª</div>
          </div>
          <div style="text-align: center;">
            <div style="font-size: 20px; font-weight: 700; color: var(--blue);">${totalUsersCount}</div>
            <div style="font-size: 13px; color: var(--text-muted); margin-top: 5px;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
          </div>
        </div>
      `;
      
      topUsersDiv.innerHTML = '<div class="admin-empty-state"><p>Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚Ø±ÙŠØ¨Ø§Ù‹</p></div>';
      
    } catch (error) {
      console.error('Error loading reports:', error);
    }
  }
  
  /* =====================================================
     SETTINGS
  ===================================================== */
  window.saveSettings = () => {
    const siteTitle = document.getElementById('siteTitle').value;
    const siteDescription = document.getElementById('siteDescription').value;
    const articleCooldown = document.getElementById('articleCooldown').value;
    const commentCooldown = document.getElementById('commentCooldown').value;
    
    // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    // Ù…Ø«Ø§Ù„: await set(ref(db, 'settings/general'), { ... })
    
    showAdminNotification('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
  };
  
  /* =====================================================
     UTILITY FUNCTIONS
  ===================================================== */
  function createPagination(container, currentPage, totalPages, type) {
    container.innerHTML = '';
    
    if (totalPages <= 1) return;
    
    // Ø²Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚
    const prevBtn = document.createElement('button');
    prevBtn.className = 'pagination-btn';
    prevBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
    prevBtn.disabled = currentPage === 1;
    prevBtn.onclick = () => {
      if (type === 'articles') {
        currentArticlePage--;
        loadArticlesTable(currentArticlePage);
      } else if (type === 'users') {
        currentUserPage--;
        loadUsersTable(currentUserPage);
      }
    };
    container.appendChild(prevBtn);
    
    // Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØµÙØ­Ø§Øª
    const startPage = Math.max(1, currentPage - 2);
    const endPage = Math.min(totalPages, currentPage + 2);
    
    if (startPage > 1) {
      const firstBtn = document.createElement('button');
      firstBtn.className = 'pagination-btn';
      firstBtn.textContent = '1';
      firstBtn.onclick = () => {
        if (type === 'articles') {
          currentArticlePage = 1;
          loadArticlesTable(currentArticlePage);
        } else if (type === 'users') {
          currentUserPage = 1;
          loadUsersTable(currentUserPage);
        }
      };
      container.appendChild(firstBtn);
      
      if (startPage > 2) {
        const ellipsis = document.createElement('span');
        ellipsis.style.padding = '8px';
        ellipsis.textContent = '...';
        container.appendChild(ellipsis);
      }
    }
    
    for (let i = startPage; i <= endPage; i++) {
      const pageBtn = document.createElement('button');
      pageBtn.className = 'pagination-btn';
      if (i === currentPage) {
        pageBtn.classList.add('active');
      }
      pageBtn.textContent = i;
      pageBtn.onclick = () => {
        if (type === 'articles') {
          currentArticlePage = i;
          loadArticlesTable(currentArticlePage);
        } else if (type === 'users') {
          currentUserPage = i;
          loadUsersTable(currentUserPage);
        }
      };
      container.appendChild(pageBtn);
    }
    
    if (endPage < totalPages) {
      if (endPage < totalPages - 1) {
        const ellipsis = document.createElement('span');
        ellipsis.style.padding = '8px';
        ellipsis.textContent = '...';
        container.appendChild(ellipsis);
      }
      
      const lastBtn = document.createElement('button');
      lastBtn.className = 'pagination-btn';
      lastBtn.textContent = totalPages;
      lastBtn.onclick = () => {
        if (type === 'articles') {
          currentArticlePage = totalPages;
          loadArticlesTable(currentArticlePage);
        } else if (type === 'users') {
          currentUserPage = totalPages;
          loadUsersTable(currentUserPage);
        }
      };
      container.appendChild(lastBtn);
    }
    
    // Ø²Ø± Ø§Ù„ØªØ§Ù„ÙŠ
    const nextBtn = document.createElement('button');
    nextBtn.className = 'pagination-btn';
    nextBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
    nextBtn.disabled = currentPage === totalPages;
    nextBtn.onclick = () => {
      if (type === 'articles') {
        currentArticlePage++;
        loadArticlesTable(currentArticlePage);
      } else if (type === 'users') {
        currentUserPage++;
        loadUsersTable(currentUserPage);
      }
    };
    container.appendChild(nextBtn);
  }
  
  async function getUserData(userId) {
    try {
      const userRef = ref(db, `users/${userId}`);
      const snap = await get(userRef);
      return snap.exists() ? snap.val() : null;
    } catch (error) {
      console.error('Error getting user data:', error);
      return null;
    }
  }
  
  function formatDate(timestamp) {
    if (!timestamp) return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
    
    const date = new Date(timestamp);
    if (isNaN(date.getTime())) return 'ØªØ§Ø±ÙŠØ® ØºÙŠØ± ØµØ§Ù„Ø­';
    
    const now = new Date();
    const diff = now - date;
    
    if (diff < 60 * 1000) {
      return 'Ø§Ù„Ø¢Ù†';
    }
    
    if (diff < 60 * 60 * 1000) {
      const minutes = Math.floor(diff / (60 * 1000));
      return `Ù…Ù†Ø° ${minutes} Ø¯Ù‚ÙŠÙ‚Ø©`;
    }
    
    if (diff < 24 * 60 * 60 * 1000) {
      const hours = Math.floor(diff / (60 * 60 * 1000));
      return `Ù…Ù†Ø° ${hours} Ø³Ø§Ø¹Ø©`;
    }
    
    if (diff < 7 * 24 * 60 * 60 * 1000) {
      const days = Math.floor(diff / (24 * 60 * 60 * 1000));
      return `Ù…Ù†Ø° ${days} ÙŠÙˆÙ…`;
    }
    
    return date.toLocaleDateString('ar-SA', {
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    });
  }
  
  function formatShortDate(timestamp) {
    if (!timestamp) return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
    
    const date = new Date(timestamp);
    if (isNaN(date.getTime())) return '--';
    
    return date.toLocaleDateString('ar-SA', {
      month: 'short',
      day: 'numeric'
    });
  }
  
  function showAdminNotification(message, type = 'success') {
    if (type === 'success') {
      adminNotificationIcon.className = 'fas fa-check-circle';
      adminNotification.classList.add('success');
      adminNotification.classList.remove('error');
    } else {
      adminNotificationIcon.className = 'fas fa-exclamation-circle';
      adminNotification.classList.add('error');
      adminNotification.classList.remove('success');
    }
    
    adminNotificationText.textContent = message;
    adminNotification.style.display = 'flex';
    
    setTimeout(() => {
      adminNotification.style.display = 'none';
    }, 3000);
  }
  
  /* =====================================================
     INITIALIZATION
  ===================================================== */
  window.addEventListener('click', (e) => {
    if (e.target === articleDetailsModal) {
      closeArticleDetailsModal();
    }
    if (e.target === userDetailsModal) {
      closeUserDetailsModal();
    }
    if (e.target === editArticleModal) {
      closeEditArticleModal();
    }
    if (e.target === createUserModal) {
      closeCreateUserModal();
    }
    if (e.target === confirmDeleteModal) {
      closeConfirmDeleteModal();
    }
    if (e.target === banUserModal) {
      closeBanUserModal();
    }
  });
  
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      closeArticleDetailsModal();
      closeUserDetailsModal();
      closeEditArticleModal();
      closeCreateUserModal();
      closeConfirmDeleteModal();
      closeBanUserModal();
      closeAdminSidebar();
    }
  });
  
  // ØªØ­Ù…ÙŠÙ„ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙƒØµÙØ­Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
  showAdminSection('dashboard');
  </script>

</body>
</html>
